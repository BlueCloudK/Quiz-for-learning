<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueQuiz - T·∫°o v√† Ch·∫•m ƒêi·ªÉm</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23667eea'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial, sans-serif' font-weight='bold'>Q</text></svg>">
    <!-- Libraries for file import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        :root {
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --container-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --card-bg: #f8f9fa;
            --border-color: #ddd;
            --input-bg: #ffffff;
            --input-border: #ddd;
            --correct-bg: #d4edda;
            --correct-text: #155724;
            --incorrect-bg: #f8d7da;
            --incorrect-text: #721c24;
            --filter-bg: #f0f4ff;
            --ai-prompts-bg-start: #a8edea;
            --ai-prompts-bg-end: #fed6e3;
            --template-bg: rgba(255, 255, 255, 0.5);
            --template-item-bg: #ffffff;
            --prompt-card-bg: #ffffff;
            --prompt-text-bg: #f8f9fa;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --accent-color: #667eea;
            --accent-color-light: #8b9efc;
        }

        body.dark-mode {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --container-bg: #0f3460;
            --text-primary: #eaeaea;
            --text-secondary: #b8b8b8;
            --card-bg: #1a1a2e;
            --border-color: #2d4356;
            --input-bg: #16213e;
            --input-border: #2d4356;
            --correct-bg: #1e4620;
            --correct-text: #4caf50;
            --incorrect-bg: #4a1c1c;
            --incorrect-text: #ff6b6b;
            --filter-bg: #1a1a2e;
            --ai-prompts-bg-start: #16213e;
            --ai-prompts-bg-end: #1a1a2e;
            --template-bg: rgba(26, 26, 46, 0.5);
            --template-item-bg: #16213e;
            --prompt-card-bg: #1a1a2e;
            --prompt-text-bg: #16213e;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --accent-color: #8b9efc;
            --accent-color-light: #a8b5ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .language-buttons {
            display: flex;
            gap: 5px;
        }

        .language-button {
            padding: 8px 15px;
            border: 2px solid white;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .language-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .language-button.active {
            background: rgba(76, 175, 80, 0.8);
            border-color: #4caf50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            transition: border-color 0.3s, background 0.3s, color 0.3s;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .hint {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-top: 5px;
            font-style: italic;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            margin-top: 20px;
        }

        .quiz-settings-group {
            width: 100%;
            background: var(--template-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .setting-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .setting-row:last-child {
            margin-bottom: 0;
        }

        .setting-row label:first-child {
            font-weight: 600;
            min-width: 110px;
            color: var(--text-primary);
        }

        .hint-text {
            font-size: 0.85em;
            color: var(--text-secondary);
            font-style: italic;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-primary);
        }

        .radio-label input[type="radio"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .radio-label:hover {
            color: var(--accent-color);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        /* File upload styles */
        .upload-container {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .file-upload-btn {
            /* Reset all default styles */
            margin: 0;
            padding: 0;
            border: none;
            background: none;
            font: inherit;

            /* Common button styles */
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 9px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            white-space: nowrap;
            text-decoration: none;
            vertical-align: middle;
        }

        .file-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .file-upload-btn input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            cursor: pointer;
        }

        .file-info {
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .upload-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #quizContainer {
            margin-top: 30px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
            box-shadow: 0 2px 10px var(--shadow-color);
            transition: background 0.3s ease;
        }

        .question-header {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .question-text {
            margin-bottom: 15px;
            line-height: 1.8;
            color: var(--text-primary);
            white-space: pre-wrap;
        }

        .question-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 15px 0;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--accent-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .question-image:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            cursor: pointer;
        }

        body.dark-mode .question-image {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border-color: var(--accent-color-light);
        }

        body.dark-mode .question-image:hover {
            box-shadow: 0 6px 20px rgba(139, 158, 252, 0.4);
        }

        /* Image Lightbox Modal */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.95);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 40px;
            color: #fff;
            font-size: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: #667eea;
        }

        /* Pause Timer Button */
        .pause-timer-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            width: 100%;
        }

        .pause-timer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .pause-timer-btn:active {
            transform: translateY(0);
        }

        body.dark-mode .pause-timer-btn {
            background: linear-gradient(135deg, #8b9efc 0%, #9f7aea 100%);
        }

        .options {
            margin-left: 20px;
        }

        .option {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option input[type="radio"]:disabled,
        .option input[type="checkbox"]:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .option input[type="radio"]:disabled + label,
        .option input[type="checkbox"]:disabled + label {
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Highlight checked options after grading */
        .option input[type="radio"]:checked:disabled + label,
        .option input[type="checkbox"]:checked:disabled + label {
            background: rgba(102, 126, 234, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            opacity: 1;
            font-weight: 600;
        }

        body.dark-mode .option input[type="radio"]:checked:disabled + label,
        body.dark-mode .option input[type="checkbox"]:checked:disabled + label {
            background: rgba(139, 158, 252, 0.3);
            color: var(--accent-color-light);
            opacity: 1;
        }

        .option label {
            cursor: pointer;
            margin: 0;
            flex: 1;
        }

        .result-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }

        .result-section h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }

        .result-details {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 10px;
        }

        .result-item h3 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .result-item p {
            font-size: 2em;
            font-weight: bold;
        }

        .question-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
        }

        .question-result.correct {
            background: var(--correct-bg);
            color: var(--correct-text);
        }

        .question-result.incorrect {
            background: var(--incorrect-bg);
            color: var(--incorrect-text);
        }

        .hidden {
            display: none;
        }

        .pin-button {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px 10px;
            margin-left: 10px;
            transition: all 0.3s;
            text-transform: none;
            letter-spacing: normal;
        }

        .pin-button:hover {
            transform: scale(1.2);
        }

        .pin-button.pinned {
            color: #ffd700;
        }

        .pin-button.unpinned {
            color: #ccc;
        }

        .question-card.pinned {
            border-left-color: #ffd700;
            background: #fffdf0;
        }

        body.dark-mode .question-card.pinned {
            border-left-color: #f59e0b;
            background: #422006;
        }

        .question-header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .filter-section {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--filter-bg);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-button {
            padding: 8px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: 600;
        }

        .filter-button:hover {
            background: #667eea;
            color: white;
        }

        .filter-button.active {
            background: #667eea;
            color: white;
        }

        .ai-prompts-section {
            background: linear-gradient(135deg, var(--ai-prompts-bg-start) 0%, var(--ai-prompts-bg-end) 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            transition: background 0.3s ease;
        }

        .ai-prompts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .ai-prompts-header h3 {
            font-size: 1.2em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        .ai-prompts-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }

        .ai-prompts-content.expanded {
            max-height: 99999px;
            margin-top: 20px;
        }

        .ai-prompts-content p {
            color: var(--text-primary);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .prompt-card {
            background: var(--prompt-card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: background 0.3s ease;
        }

        .prompt-card h4 {
            color: var(--accent-color);
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .prompt-card p {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .quick-templates-title {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .prompt-text {
            background: var(--prompt-text-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
            line-height: 1.6;
            color: var(--text-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 10px;
            max-height: 200px;
            overflow-y: auto;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .copy-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .quick-templates {
            background: var(--template-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            transition: background 0.3s ease;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .template-item {
            background: var(--template-item-bg);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 6px var(--shadow-color);
            transition: background 0.3s ease;
        }

        .template-label {
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .template-box {
            background: var(--prompt-text-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8em;
            line-height: 1.5;
            color: var(--text-primary);
            white-space: pre-wrap;
            margin-bottom: 10px;
            max-height: 150px;
            overflow-y: auto;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .exam-mode-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .timer-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-input-group input {
            width: 80px;
            padding: 8px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .timer-input-group label {
            color: var(--text-primary);
            font-weight: 600;
            margin: 0;
        }

        body.dark-mode .timer-input-group input {
            border: 2px solid var(--accent-color-light);
            background: rgba(26, 26, 46, 0.8);
            color: #e5e7eb;
        }

        body.dark-mode .timer-input-group label {
            color: #e5e7eb;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Quiz Management Styles */
        .quiz-management {
            background: linear-gradient(135deg, #7f7fd5 0%, #86a8e7 50%, #91eae4 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .quiz-management h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .quiz-save-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quiz-save-section input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 1em;
        }

        .quiz-save-section button {
            background: rgba(255, 255, 255, 0.9);
            color: #7f7fd5;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-save-section button:hover {
            background: white;
            transform: translateY(-2px);
        }

        .saved-quizzes-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .saved-quiz-item {
            background: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .saved-quiz-item:last-child {
            margin-bottom: 0;
        }

        .saved-quiz-info {
            flex: 1;
            color: #333;
        }

        .saved-quiz-name {
            font-weight: 600;
            font-size: 1em;
            margin-bottom: 5px;
        }

        .saved-quiz-meta {
            font-size: 0.85em;
            color: #666;
        }

        .saved-quiz-actions {
            display: flex;
            gap: 8px;
        }

        .btn-load, .btn-delete {
            padding: 6px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-load {
            background: #4caf50;
            color: white;
        }

        .btn-load:hover {
            background: #45a049;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        /* Statistics Styles */
        .stats-button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px 0;
        }

        .stats-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .statistics-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px var(--shadow-color);
            transition: background 0.3s ease;
        }

        .statistics-section h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: white;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .history-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .history-table td {
            color: var(--text-primary);
        }

        .history-table tr:hover {
            background: var(--filter-bg);
        }

        .score-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .score-excellent {
            background: #4caf50;
            color: white;
        }

        .score-good {
            background: #8bc34a;
            color: white;
        }

        .score-average {
            background: #ffc107;
            color: #333;
        }

        .score-poor {
            background: #ff5722;
            color: white;
        }

        .clear-history-btn {
            background: #f44336;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .clear-history-btn:hover {
            background: #da190b;
        }

        /* Question Navigator Sidebar */
        .quiz-layout {
            position: relative;
        }

        .question-navigator {
            position: fixed;
            left: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: var(--card-bg);
            padding: 20px;
            box-shadow: 5px 0 20px var(--shadow-color);
            transition: transform 0.3s ease, background 0.3s ease;
            overflow-y: auto;
            z-index: 1000;
            transform: translateX(-100%);
        }

        .question-navigator.active {
            display: block;
        }

        .question-navigator.open {
            transform: translateX(0);
        }

        .quiz-main-content {
            margin-left: 0;
        }

        .navigator-header {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navigator-close-btn {
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-primary);
            transition: color 0.3s, transform 0.3s;
            user-select: none;
        }

        .navigator-close-btn:hover {
            color: var(--accent-color);
            transform: scale(1.2);
        }

        /* Sidebar Toggle Button */
        .sidebar-toggle-btn {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 999;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            display: none;
        }

        .sidebar-toggle-btn.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-toggle-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: scale(1.05);
        }

        body.dark-mode .sidebar-toggle-btn {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid var(--accent-color-light);
        }

        .navigator-content {
            overflow: hidden;
        }

        /* Fixed Right Timer Panel */
        .fixed-right-timer {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 280px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px var(--shadow-color);
            transition: background 0.3s ease;
            z-index: 100;
            display: none;
        }

        .fixed-right-timer.active {
            display: block;
        }

        .timer-panel-header {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            text-align: center;
        }

        .timer-display-box {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 30px 20px;
            border-radius: 10px;
            text-align: center;
            border: 3px solid #f0c000;
        }

        body.dark-mode .timer-display-box {
            background: linear-gradient(135deg, #2d3436 0%, #1a1a2e 100%);
            border-color: #4a5568;
        }

        .fixed-timer-text {
            font-size: 2.5em;
            font-weight: bold;
            color: #1a1a2e;
            margin: 0;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        body.dark-mode .fixed-timer-text {
            color: #4ade80;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
        }

        .fixed-timer-text.warning {
            color: #d97706;
        }

        body.dark-mode .fixed-timer-text.warning {
            color: #fbbf24;
            text-shadow: 0 0 15px rgba(251, 191, 36, 0.4);
        }

        .fixed-timer-text.danger {
            color: #dc2626;
            animation: pulse 0.5s infinite;
        }

        body.dark-mode .fixed-timer-text.danger {
            color: #f87171;
            text-shadow: 0 0 20px rgba(248, 113, 113, 0.6);
        }

        .fixed-timer-label {
            color: #374151;
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        body.dark-mode .fixed-timer-label {
            color: #9ca3af;
        }

        .question-nav-list {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .question-nav-item {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .question-nav-item:hover {
            transform: scale(1.05);
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .question-nav-item.answered {
            background: #2196f3;
            border-color: #1976d2;
            color: white;
        }

        body.dark-mode .question-nav-item.answered {
            background: #1e40af;
            border-color: #3b82f6;
            color: #e0f2fe;
        }

        .question-nav-item.correct {
            background: #4caf50;
            border-color: #4caf50;
            color: white;
        }

        body.dark-mode .question-nav-item.correct {
            background: #15803d;
            border-color: #22c55e;
            color: #dcfce7;
        }

        .question-nav-item.incorrect {
            background: #ff5722;
            border-color: #ff5722;
            color: white;
        }

        body.dark-mode .question-nav-item.incorrect {
            background: #b91c1c;
            border-color: #ef4444;
            color: #fee2e2;
        }

        .question-nav-item.current {
            border-color: #667eea;
            border-width: 3px;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .question-nav-item.pinned {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-color: #ffd700;
            color: #1a1a2e;
            font-weight: bold;
        }

        body.dark-mode .question-nav-item.pinned {
            background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
            border-color: #f59e0b;
            color: #fef3c7;
        }

        .question-nav-item.pinned.answered {
            background: linear-gradient(135deg, #ffd700 0%, #4ade80 100%);
            color: #1a1a2e;
        }

        body.dark-mode .question-nav-item.pinned.answered {
            background: linear-gradient(135deg, #b45309 0%, #15803d 100%);
            border-color: #22c55e;
            color: #dcfce7;
        }

        /* Fixed Control Panel - Bottom Right */
        .fixed-control-panel {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 280px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px var(--shadow-color);
            transition: background 0.3s ease;
            z-index: 100;
            display: none;
        }

        .fixed-control-panel.active {
            display: block;
        }

        .control-panel-header {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            text-align: center;
        }

        .navigator-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-nav {
            width: 100%;
            padding: 12px;
            font-size: 0.95em;
            border-radius: 8px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .template-grid {
                grid-template-columns: 1fr;
            }


            .question-navigator {
                width: 90% !important;
                max-width: 320px;
                transform: translateX(-100%);
            }

            .question-navigator.open {
                transform: translateX(0) !important;
            }

            .sidebar-toggle-btn {
                left: 10px;
                width: 45px;
                height: 45px;
                font-size: 1.3em;
            }

            .quiz-main-content {
                margin-left: 0 !important;
            }

            .question-nav-list {
                grid-template-columns: repeat(6, 1fr);
            }

            .fixed-right-timer {
                position: relative !important;
                right: auto !important;
                top: auto !important;
                width: 100% !important;
                margin-bottom: 20px;
            }

            .fixed-control-panel {
                position: relative !important;
                right: auto !important;
                bottom: auto !important;
                width: 100% !important;
                margin-top: 20px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            button:not(.pin-button):not(.filter-button) {
                width: 100%;
            }

            .question-header-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
            margin-top: 60px;
            border-top: 3px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .footer p {
            margin: 10px 0;
            font-size: 1em;
        }

        .footer a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: opacity 0.3s, transform 0.2s;
            display: inline-block;
        }

        .footer a:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .footer .separator {
            margin: 0 15px;
            opacity: 0.5;
        }

        body.dark-mode .footer {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-top-color: rgba(139, 158, 252, 0.2);
        }

        body.dark-mode .footer a {
            color: var(--accent-color-light);
        }
    </style>
</head>
<body>
    <!-- Fixed Right Timer Panel -->
    <div class="fixed-right-timer" id="fixedRightTimer">
        <div class="timer-panel-header" data-i18n="timerPanelHeader">‚è±Ô∏è Th·ªùi Gian</div>
        <div class="timer-display-box">
            <div class="fixed-timer-label" data-i18n="timeRemaining">Th·ªùi gian c√≤n l·∫°i:</div>
            <div class="fixed-timer-text" id="fixedTimerText">00:30:00</div>
        </div>
        <button class="pause-timer-btn" id="pauseTimerBtn" onclick="togglePauseTimer()" style="display: none;">
            <span id="pauseIcon">‚è∏Ô∏è</span> <span id="pauseText" data-i18n="pauseTimer">T·∫°m d·ª´ng</span>
        </button>
    </div>

    <!-- Fixed Control Panel - Bottom Right -->
    <div class="fixed-control-panel" id="fixedControlPanel">
        <div class="control-panel-header" data-i18n="controlPanelHeader">üéÆ ƒêi·ªÅu Khi·ªÉn</div>
        <div class="navigator-controls">
            <button class="btn-success btn-nav" onclick="submitQuiz()" data-i18n="submitBtn">Ch·∫•m ƒêi·ªÉm</button>
            <button class="btn-secondary btn-nav" onclick="backToEdit()" data-i18n="backToEditBtn">‚¨ÖÔ∏è Quay L·∫°i</button>
            <button class="btn-secondary btn-nav" onclick="restartQuiz()" data-i18n="restartBtn">üîÑ L√†m L·∫°i</button>
            <button class="btn-primary btn-nav hidden" id="retryAllBtn" onclick="retryAllQuestions()" data-i18n="retryAllBtn">üîÑ L√†m L·∫°i T·∫•t C·∫£</button>
            <button class="btn-warning btn-nav hidden" id="retryIncorrectBtn" onclick="retryIncorrectQuestions()" data-i18n="retryIncorrectBtn">L√†m L·∫°i C√¢u Sai</button>
            <button class="btn-info btn-nav hidden" id="retryPinnedBtn" onclick="retryPinnedQuestions()" data-i18n="retryPinnedBtn">L√†m L·∫°i C√¢u ƒê√£ Pin</button>
        </div>
    </div>

    <!-- Image Lightbox Modal -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="modal-close">&times;</span>
        <img class="modal-content" id="modalImage" onclick="event.stopPropagation()">
    </div>

    <div class="container">
        <div class="header">
            <div class="language-selector">
                <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle" title="Toggle dark mode">
                    üåô
                </button>
                <div class="language-buttons">
                    <button class="language-button active" id="langVi" onclick="changeLanguage('vi')">üáªüá≥ VI</button>
                    <button class="language-button" id="langEn" onclick="changeLanguage('en')">üá¨üáß EN</button>
                </div>
            </div>
            <h1 data-i18n="title">üìù BlueQuiz</h1>
            <p data-i18n="subtitle">T·∫°o b·ªô c√¢u h·ªèi, x√°o tr·ªôn v√† ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông</p>
        </div>

        <div class="content">
            <!-- AI Prompts Section -->
            <div class="ai-prompts-section">
                <div class="ai-prompts-header" onclick="toggleAIPrompts()">
                    <h3>
                        <span>ü§ñ</span>
                        <span data-i18n="aiPromptsTitle">H∆∞·ªõng D·∫´n T·∫°o C√¢u H·ªèi V·ªõi AI Chatbot</span>
                    </h3>
                    <span class="toggle-icon" id="toggleIcon">‚ñº</span>
                </div>
                <div class="ai-prompts-content" id="aiPromptsContent">
                    <p data-i18n="aiPromptsDesc">Copy c√°c prompt sau v√† paste v√†o ChatGPT, Claude, ho·∫∑c AI chatbot kh√°c ƒë·ªÉ t·ª± ƒë·ªông t·∫°o c√¢u h·ªèi ƒë√∫ng format:</p>

                    <!-- Quick Copy Templates -->
                    <div class="quick-templates">
                        <h4 class="quick-templates-title" data-i18n="quickTemplatesTitle">üìã Ho·∫∑c Copy Template M·∫´u ƒê·ªÉ Paste Tr·ª±c Ti·∫øp:</h4>

                        <div class="template-grid">
                            <div class="template-item">
                                <div class="template-label" data-i18n="templateQuestionsLabel">M·∫´u C√¢u H·ªèi:</div>
                                <div class="template-box" id="questionsTemplate">1. C√¢u h·ªèi th·ª© nh·∫•t?
a. ƒê√°p √°n A
b. ƒê√°p √°n B
c. ƒê√°p √°n C
d. ƒê√°p √°n D

2. C√¢u h·ªèi th·ª© hai?
a. ƒê√°p √°n A
b. ƒê√°p √°n B
c. ƒê√°p √°n C
d. ƒê√°p √°n D

3. C√¢u h·ªèi th·ª© ba (nhi·ªÅu ƒë√°p √°n ƒë√∫ng)?
a. L·ª±a ch·ªçn A
b. L·ª±a ch·ªçn B
c. L·ª±a ch·ªçn C
d. L·ª±a ch·ªçn D
e. L·ª±a ch·ªçn E</div>
                                <button class="copy-btn" onclick="copyTemplate('questions')" id="copyQuestionsBtn">
                                    <span data-i18n="copyBtn">Copy</span>
                                </button>
                            </div>

                            <div class="template-item">
                                <div class="template-label" data-i18n="templateAnswersLabel">M·∫´u ƒê√°p √Ån:</div>
                                <div class="template-box" id="answersTemplate">1. a
2. b
3. a,c,e</div>
                                <button class="copy-btn" onclick="copyTemplate('answers')" id="copyAnswersBtn">
                                    <span data-i18n="copyBtn">Copy</span>
                                </button>
                            </div>

                            <div class="template-item">
                                <div class="template-label" data-i18n="templateListItemsLabel">M·∫´u List Items:</div>
                                <div class="template-box" id="listItemsTemplate">C√°c ho·∫°t ƒë·ªông n√†o sau ƒë√¢y l√† ch√≠nh trong quy tr√¨nh review?
- 1. L·∫≠p k·∫ø ho·∫°ch
- 2. Review c√° nh√¢n
- 3. H·ªçp nh√≥m
- 4. S·ª≠a l·ªói
- 5. T√†i li·ªáu h√≥a
- 6. Ki·ªÉm th·ª≠

A. 1, 2, 4
B. 2, 3, 5
C. 1, 2, 3, 4
D. T·∫•t c·∫£ c√°c m·ª•c</div>
                                <button class="copy-btn" onclick="copyTemplate('listItems')" id="copyListItemsBtn">
                                    <span data-i18n="copyBtn">Copy</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <hr style="margin: 25px 0; border: none; border-top: 1px solid #ddd;">

                    <div id="promptsContainer"></div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="section" id="inputSection">
                <h2 class="section-title" data-i18n="step1">B∆∞·ªõc 1: Nh·∫≠p D·ªØ Li·ªáu</h2>

                <!-- Quiz Management -->
                <div class="quiz-management">
                    <h3>üíæ <span data-i18n="quizManagement">Qu·∫£n L√Ω B·ªô Quiz</span></h3>
                    <div class="quiz-save-section">
                        <input type="text" id="quizNameInput" data-i18n-placeholder="quizNamePlaceholder" placeholder="Nh·∫≠p t√™n b·ªô quiz (VD: L·ªãch S·ª≠ Vi·ªát Nam, JavaScript Basics...)">
                        <button onclick="saveQuizSet()" data-i18n="saveQuizBtn">üíæ L∆∞u B·ªô Quiz</button>
                    </div>
                    <div class="saved-quizzes-list" id="savedQuizzesList">
                        <!-- Saved quizzes will appear here -->
                    </div>
                </div>

                <div class="input-group">
                    <label for="questionsInput" data-i18n="questionsLabel">C√¢u h·ªèi v√† ƒë√°p √°n:</label>
                    <textarea id="questionsInput" rows="12" data-i18n-placeholder="questionsPlaceholder"></textarea>
                    <div class="upload-container">
                        <label class="file-upload-btn">
                            üìÅ <span data-i18n="importFileBtn">Import t·ª´ file</span>
                            <input type="file" id="questionsFileInput" accept=".xlsx,.xls,.docx,.txt" onchange="handleQuestionsFileUpload(event)">
                        </label>
                        <label class="file-upload-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            üñºÔ∏è <span data-i18n="addImageBtn">Th√™m ·∫£nh</span>
                            <input type="file" id="imageFileInput" accept="image/*" onchange="handleImageUpload(event)" multiple style="display: none;">
                        </label>
                        <button class="file-upload-btn" onclick="exportQuestions('txt')" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                            üíæ <span data-i18n="exportTxtBtn">Export TXT</span>
                        </button>
                        <button class="file-upload-btn" onclick="exportQuestions('xlsx')" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                            üíæ <span data-i18n="exportExcelBtn">Export Excel</span>
                        </button>
                        <span class="file-info" id="questionsFileInfo"></span>
                    </div>
                    <p class="hint" data-i18n="questionsHint">M·ªói c√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng s·ªë th·ª© t·ª±, c√°c ƒë√°p √°n b·∫Øt ƒë·∫ßu b·∫±ng a, b, c, d...</p>
                    <p class="upload-hint" data-i18n="uploadHint">H·ªó tr·ª£: Excel (.xlsx, .xls), Word (.docx), Text (.txt)</p>
                    <p class="upload-hint" data-i18n="imageHint">Th√™m ·∫£nh: Ch·ªçn ·∫£nh t·ª´ m√°y t√≠nh, tag [IMG:...] s·∫Ω ƒë∆∞·ª£c th√™m v√†o v·ªã tr√≠ con tr·ªè</p>
                </div>

                <div class="input-group">
                    <label for="answersInput" data-i18n="answersLabel">ƒê√°p √°n ƒë√∫ng:</label>
                    <textarea id="answersInput" rows="6" data-i18n-placeholder="answersPlaceholder"></textarea>
                    <div class="upload-container">
                        <label class="file-upload-btn">
                            üìÅ <span data-i18n="importFileBtn">Import t·ª´ file</span>
                            <input type="file" id="answersFileInput" accept=".xlsx,.xls,.docx,.txt" onchange="handleAnswersFileUpload(event)">
                        </label>
                        <button class="file-upload-btn" onclick="exportAnswers('txt')" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                            üíæ <span data-i18n="exportTxtBtn">Export TXT</span>
                        </button>
                        <button class="file-upload-btn" onclick="exportAnswers('xlsx')" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                            üíæ <span data-i18n="exportExcelBtn">Export Excel</span>
                        </button>
                        <span class="file-info" id="answersFileInfo"></span>
                    </div>
                    <p class="hint" data-i18n="answersHint">Nh·∫≠p ƒë√°p √°n ƒë√∫ng cho m·ªói c√¢u theo s·ªë th·ª© t·ª±</p>
                    <p class="upload-hint" data-i18n="uploadHint">H·ªó tr·ª£: Excel (.xlsx, .xls), Word (.docx), Text (.txt)</p>
                </div>

                <div class="controls">
                    <div class="quiz-settings-group">
                        <div class="setting-row">
                            <label for="questionCount" data-i18n="questionCountLabel">S·ªë c√¢u h·ªèi:</label>
                            <input type="number" id="questionCount" min="1" placeholder="T·∫•t c·∫£" style="width: 100px; padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                            <span class="hint-text" data-i18n="questionCountHint">(ƒê·ªÉ tr·ªëng = t·∫•t c·∫£)</span>
                        </div>
                        <div class="setting-row">
                            <label data-i18n="questionOrderLabel">Th·ª© t·ª± c√¢u h·ªèi:</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="questionOrder" value="sequential" checked>
                                    <span data-i18n="orderSequential">Tr√¨nh t·ª±</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="questionOrder" value="random">
                                    <span data-i18n="orderRandom">Ng·∫´u nhi√™n</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="shuffleCheckbox">
                        <label for="shuffleCheckbox" data-i18n="shuffleLabel">X√°o tr·ªôn c√¢u h·ªèi</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="examModeCheckbox" onchange="toggleExamMode()">
                        <label for="examModeCheckbox" data-i18n="enableExamMode">‚è±Ô∏è B·∫≠t ch·∫ø ƒë·ªô thi</label>
                    </div>
                    <div class="timer-input-group" id="timerInputGroup" style="display: none;">
                        <label for="timerHours" data-i18n="hours">Gi·ªù:</label>
                        <input type="number" id="timerHours" min="0" max="23" value="0" />
                        <label for="timerMinutes" data-i18n="minutes">Ph√∫t:</label>
                        <input type="number" id="timerMinutes" min="0" max="59" value="30" />
                    </div>
                    <button class="btn-primary" onclick="generateQuiz()" data-i18n="createQuizBtn">T·∫°o Quiz</button>
                </div>
            </div>

            <!-- Quiz Section -->
            <div class="section hidden" id="quizSection">
                <!-- Sidebar Toggle Button -->
                <button class="sidebar-toggle-btn" id="sidebarToggleBtn" onclick="toggleSidebar()">
                    ‚ò∞
                </button>

                <!-- Quiz Layout with Navigator -->
                <div class="quiz-layout">
                    <!-- Question Navigator Sidebar -->
                    <div class="question-navigator" id="questionNavigator">
                        <div class="navigator-header">
                            <span data-i18n="questionNavigator">Danh S√°ch C√¢u H·ªèi</span>
                            <span class="navigator-close-btn" onclick="toggleSidebar()">‚úï</span>
                        </div>

                        <!-- Question Navigation List -->
                        <div class="navigator-content" id="navigatorContent">
                            <div class="question-nav-list" id="questionNavList">
                                <!-- Question nav items will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <!-- Main Quiz Content -->
                    <div class="quiz-main-content">
                        <!-- Filter Section -->
                        <div class="filter-section" id="filterSection" style="display: none;">
                            <label style="margin-bottom: 10px;" data-i18n="filterLabel">L·ªçc c√¢u h·ªèi:</label>
                            <div class="filter-buttons">
                                <button class="filter-button active" onclick="filterQuestions('all')" data-i18n="filterAll">T·∫•t c·∫£</button>
                                <button class="filter-button" onclick="filterQuestions('pinned')" data-i18n="filterPinned">C√¢u ƒë√£ pin</button>
                                <button class="filter-button" onclick="filterQuestions('incorrect')" data-i18n="filterIncorrect">C√¢u sai</button>
                            </div>
                        </div>

                        <div id="quizContainer"></div>
                    </div>
                </div>
            </div>

            <!-- Result Section -->
            <div id="resultSection" class="hidden"></div>

            <!-- Statistics Button -->
            <div style="text-align: center; margin: 20px 0;">
                <button class="stats-button" onclick="toggleStatistics()" id="statsToggleBtn">
                    üìä <span data-i18n="viewStatistics">Xem Th·ªëng K√™</span>
                </button>
            </div>

            <!-- Statistics Section -->
            <div class="statistics-section hidden" id="statisticsSection">
                <h2>üìä <span data-i18n="statisticsTitle">Th·ªëng K√™ & L·ªãch S·ª≠</span></h2>

                <div class="stats-grid" id="statsGrid">
                    <!-- Stats cards will be inserted here -->
                </div>

                <h3 style="margin: 30px 0 15px 0; color: var(--text-primary);">
                    <span data-i18n="recentHistory">L·ªãch S·ª≠ G·∫ßn ƒê√¢y</span>
                </h3>
                <div id="historyTableContainer">
                    <!-- History table will be inserted here -->
                </div>

                <button class="clear-history-btn" onclick="clearHistory()">
                    üóëÔ∏è <span data-i18n="clearHistory">X√≥a L·ªãch S·ª≠</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>
                Made with ‚ù§Ô∏è by <a href="https://github.com/BlueCloudK" target="_blank" rel="noopener noreferrer">BlueCloudK</a>
            </p>
            <p>
                <a href="https://github.com/BlueCloudK/Quiz-for-learning" target="_blank" rel="noopener noreferrer">
                    ‚≠ê Star on GitHub
                </a>
                <span class="separator">|</span>
                üìß thanhkiennk@gmail.com
            </p>
        </div>
    </footer>

    <script>
        let quizData = [];
        let correctAnswers = {};
        let questionMapping = {}; // L∆∞u mapping gi·ªØa v·ªã tr√≠ hi·ªán t·∫°i v√† s·ªë th·ª© t·ª± g·ªëc
        let pinnedQuestions = new Set(); // L∆∞u index c√°c c√¢u ƒë∆∞·ª£c pin
        let incorrectQuestions = new Set(); // L∆∞u index c√°c c√¢u sai
        let isGraded = false; // Track xem ƒë√£ ch·∫•m ƒëi·ªÉm ch∆∞a
        let originalQuestionsText = ''; // L∆∞u c√¢u h·ªèi g·ªëc
        let originalAnswersText = ''; // L∆∞u ƒë√°p √°n g·ªëc
        let currentFilter = 'all'; // B·ªô l·ªçc hi·ªán t·∫°i
        let currentLanguage = 'vi'; // Ng√¥n ng·ªØ hi·ªán t·∫°i
        let quizHistory = []; // L∆∞u l·ªãch s·ª≠ l√†m b√†i

        // Exam Mode variables
        let examModeEnabled = false;
        let timerInterval = null;
        let timeRemaining = 0; // in seconds

        // LocalStorage keys
        const STORAGE_KEYS = {
            QUESTIONS: 'quiz_questions',
            ANSWERS: 'quiz_answers',
            PINNED: 'quiz_pinned',
            LANGUAGE: 'quiz_language',
            HISTORY: 'quiz_history',
            THEME: 'quiz_theme',
            SAVED_QUIZZES: 'quiz_saved_sets'
        };

        // LocalStorage helper functions
        function saveToStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }

        function loadFromStorage(key, defaultValue = null) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error('Failed to load from localStorage:', e);
                return defaultValue;
            }
        }

        function clearStorage(key) {
            try {
                localStorage.removeItem(key);
            } catch (e) {
                console.error('Failed to clear from localStorage:', e);
            }
        }

        // Auto-save functions
        function autoSaveQuestions() {
            const questionsText = document.getElementById('questionsInput').value;
            if (questionsText.trim()) {
                saveToStorage(STORAGE_KEYS.QUESTIONS, questionsText);
            }
        }

        function autoSaveAnswers() {
            const answersText = document.getElementById('answersInput').value;
            if (answersText.trim()) {
                saveToStorage(STORAGE_KEYS.ANSWERS, answersText);
            }
        }

        function savePinnedQuestions() {
            saveToStorage(STORAGE_KEYS.PINNED, Array.from(pinnedQuestions));
        }

        function saveLanguage(lang) {
            saveToStorage(STORAGE_KEYS.LANGUAGE, lang);
        }

        function saveQuizHistory(score, total, correct, incorrect, unanswered) {
            const historyEntry = {
                date: new Date().toISOString(),
                score: score,
                total: total,
                correct: correct,
                incorrect: incorrect,
                unanswered: unanswered,
                questionsCount: total
            };

            quizHistory.unshift(historyEntry); // Add to beginning
            if (quizHistory.length > 50) { // Keep last 50 attempts
                quizHistory = quizHistory.slice(0, 50);
            }

            saveToStorage(STORAGE_KEYS.HISTORY, quizHistory);
        }

        // Load data from localStorage
        function loadSavedData() {
            // Load language preference
            const savedLanguage = loadFromStorage(STORAGE_KEYS.LANGUAGE, 'vi');
            currentLanguage = savedLanguage;

            // Load questions and answers
            const savedQuestions = loadFromStorage(STORAGE_KEYS.QUESTIONS, '');
            const savedAnswers = loadFromStorage(STORAGE_KEYS.ANSWERS, '');

            if (savedQuestions) {
                document.getElementById('questionsInput').value = savedQuestions;
            }

            if (savedAnswers) {
                document.getElementById('answersInput').value = savedAnswers;
            }

            // Load pinned questions
            const savedPinned = loadFromStorage(STORAGE_KEYS.PINNED, []);
            pinnedQuestions = new Set(savedPinned);

            // Load quiz history
            quizHistory = loadFromStorage(STORAGE_KEYS.HISTORY, []);

            // Load theme
            const savedTheme = loadFromStorage(STORAGE_KEYS.THEME, 'light');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                updateThemeToggleIcon();
            }
        }

        // Dark Mode functions
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            saveToStorage(STORAGE_KEYS.THEME, isDark ? 'dark' : 'light');
            updateThemeToggleIcon();
        }

        function updateThemeToggleIcon() {
            const themeToggle = document.getElementById('themeToggle');
            const isDark = document.body.classList.contains('dark-mode');
            themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            themeToggle.title = isDark ? 'Switch to light mode' : 'Switch to dark mode';
        }

        // Exam Mode functions
        function toggleExamMode() {
            examModeEnabled = document.getElementById('examModeCheckbox').checked;
            const timerInputGroup = document.getElementById('timerInputGroup');

            if (examModeEnabled) {
                // Show timer input fields
                timerInputGroup.style.display = 'flex';
            } else {
                // Hide timer input fields and stop timer if running
                timerInputGroup.style.display = 'none';
                if (timerInterval) {
                    stopTimer();
                }
            }
        }

        function startTimer() {
            updateTimerDisplay();
            // Show pause button when timer starts
            document.getElementById('pauseTimerBtn').style.display = 'block';
            timerInterval = setInterval(() => {
                if (timeRemaining <= 0) {
                    stopTimer();
                    alert(translations[currentLanguage].timeUp);
                    submitQuiz();
                    return;
                }

                timeRemaining--;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            // Hide pause button when timer stops
            document.getElementById('pauseTimerBtn').style.display = 'none';
        }

        // Pause/Resume timer functionality
        let timerPaused = false;

        function togglePauseTimer() {
            const pauseIcon = document.getElementById('pauseIcon');
            const pauseText = document.getElementById('pauseText');

            if (timerPaused) {
                // Resume timer
                startTimer();
                timerPaused = false;
                pauseIcon.textContent = '‚è∏Ô∏è';
                pauseText.textContent = translations[currentLanguage].pauseTimer || 'T·∫°m d·ª´ng';
            } else {
                // Pause timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                timerPaused = true;
                pauseIcon.textContent = '‚ñ∂Ô∏è';
                pauseText.textContent = translations[currentLanguage].resumeTimer || 'Ti·∫øp t·ª•c';
            }
        }

        function updateTimerDisplay() {
            const fixedTimerText = document.getElementById('fixedTimerText');
            const formattedTime = formatTime(timeRemaining);

            fixedTimerText.textContent = formattedTime;

            // Add warning/danger classes
            fixedTimerText.classList.remove('warning', 'danger');

            if (timeRemaining <= 60) {
                fixedTimerText.classList.add('danger');
            } else if (timeRemaining <= 300) {
                fixedTimerText.classList.add('warning');
            }
        }

        function formatTime(seconds) {
            // Ensure non-negative time display
            const time = Math.max(0, seconds);
            const hours = Math.floor(time / 3600);
            const mins = Math.floor((time % 3600) / 60);
            const secs = time % 60;
            return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Quiz Management functions
        function saveQuizSet() {
            const quizName = document.getElementById('quizNameInput').value.trim();
            const questionsText = document.getElementById('questionsInput').value.trim();
            const answersText = document.getElementById('answersInput').value.trim();

            if (!quizName) {
                alert(translations[currentLanguage].alertNoQuizName);
                return;
            }

            if (!questionsText || !answersText) {
                alert(translations[currentLanguage].alertNoData);
                return;
            }

            // Get existing saved quizzes
            const savedQuizzes = loadFromStorage(STORAGE_KEYS.SAVED_QUIZZES, []);

            // Create new quiz object
            const newQuiz = {
                id: Date.now(),
                name: quizName,
                questions: questionsText,
                answers: answersText,
                questionCount: parseQuestions(questionsText).length,
                savedDate: new Date().toISOString()
            };

            // Add to saved quizzes
            savedQuizzes.unshift(newQuiz);

            // Save to storage
            saveToStorage(STORAGE_KEYS.SAVED_QUIZZES, savedQuizzes);

            // Clear quiz name input
            document.getElementById('quizNameInput').value = '';

            // Refresh display
            displaySavedQuizzes();

            alert(translations[currentLanguage].alertQuizSaved);
        }

        function loadQuizSet(quizId) {
            const savedQuizzes = loadFromStorage(STORAGE_KEYS.SAVED_QUIZZES, []);
            const quiz = savedQuizzes.find(q => q.id === quizId);

            if (quiz) {
                document.getElementById('questionsInput').value = quiz.questions;
                document.getElementById('answersInput').value = quiz.answers;

                // Auto-save to current storage
                autoSaveQuestions();
                autoSaveAnswers();

                // Scroll to input section
                document.getElementById('inputSection').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function deleteQuizSet(quizId) {
            if (confirm(translations[currentLanguage].confirmDelete)) {
                let savedQuizzes = loadFromStorage(STORAGE_KEYS.SAVED_QUIZZES, []);
                savedQuizzes = savedQuizzes.filter(q => q.id !== quizId);
                saveToStorage(STORAGE_KEYS.SAVED_QUIZZES, savedQuizzes);
                displaySavedQuizzes();
            }
        }

        function displaySavedQuizzes() {
            const container = document.getElementById('savedQuizzesList');
            const savedQuizzes = loadFromStorage(STORAGE_KEYS.SAVED_QUIZZES, []);

            if (savedQuizzes.length === 0) {
                container.innerHTML = `<p style="color: white; text-align: center; padding: 20px;">${translations[currentLanguage].noSavedQuizzes}</p>`;
                return;
            }

            container.innerHTML = savedQuizzes.map(quiz => {
                const date = new Date(quiz.savedDate);
                const dateStr = date.toLocaleString(currentLanguage === 'vi' ? 'vi-VN' : 'en-US', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="saved-quiz-item">
                        <div class="saved-quiz-info">
                            <div class="saved-quiz-name">${quiz.name}</div>
                            <div class="saved-quiz-meta">${quiz.questionCount} ${translations[currentLanguage].questions} ‚Ä¢ ${translations[currentLanguage].savedOn} ${dateStr}</div>
                        </div>
                        <div class="saved-quiz-actions">
                            <button class="btn-load" onclick="loadQuizSet(${quiz.id})">${translations[currentLanguage].loadBtn}</button>
                            <button class="btn-delete" onclick="deleteQuizSet(${quiz.id})">${translations[currentLanguage].deleteBtn}</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Statistics functions
        function toggleStatistics() {
            const statsSection = document.getElementById('statisticsSection');
            const statsBtn = document.getElementById('statsToggleBtn');
            const isHidden = statsSection.classList.contains('hidden');

            if (isHidden) {
                statsSection.classList.remove('hidden');
                statsBtn.innerHTML = `üìä <span data-i18n="hideStatistics">${translations[currentLanguage].hideStatistics}</span>`;
                displayStatistics();
                statsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                statsSection.classList.add('hidden');
                statsBtn.innerHTML = `üìä <span data-i18n="viewStatistics">${translations[currentLanguage].viewStatistics}</span>`;
            }
        }

        function displayStatistics() {
            const history = quizHistory;

            if (history.length === 0) {
                document.getElementById('statsGrid').innerHTML = `
                    <p style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">
                        ${translations[currentLanguage].noHistory}
                    </p>
                `;
                document.getElementById('historyTableContainer').innerHTML = '';
                return;
            }

            // Calculate statistics
            const totalAttempts = history.length;
            const scores = history.map(h => parseFloat(h.score));
            const averageScore = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1);
            const highestScore = Math.max(...scores).toFixed(1);
            const lowestScore = Math.min(...scores).toFixed(1);

            // Display stat cards
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">${translations[currentLanguage].totalAttempts}</div>
                    <div class="stat-value">${totalAttempts}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">${translations[currentLanguage].averageScore}</div>
                    <div class="stat-value">${averageScore}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">${translations[currentLanguage].highestScore}</div>
                    <div class="stat-value">${highestScore}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">${translations[currentLanguage].lowestScore}</div>
                    <div class="stat-value">${lowestScore}%</div>
                </div>
            `;

            // Display history table
            const historyTableContainer = document.getElementById('historyTableContainer');
            historyTableContainer.innerHTML = `
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>${translations[currentLanguage].date}</th>
                            <th>${translations[currentLanguage].score}</th>
                            <th>${translations[currentLanguage].totalQuestions}</th>
                            <th>${translations[currentLanguage].correctAnswers}</th>
                            <th>${translations[currentLanguage].incorrectAnswers}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${history.map(entry => {
                            const date = new Date(entry.date);
                            const dateStr = date.toLocaleString(currentLanguage === 'vi' ? 'vi-VN' : 'en-US', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            const scoreBadgeClass = getScoreBadgeClass(entry.score);

                            return `
                                <tr>
                                    <td>${dateStr}</td>
                                    <td><span class="score-badge ${scoreBadgeClass}">${entry.score}%</span></td>
                                    <td>${entry.total}</td>
                                    <td style="color: #4caf50; font-weight: 600;">${entry.correct}</td>
                                    <td style="color: #ff5722; font-weight: 600;">${entry.incorrect}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        function getScoreBadgeClass(score) {
            const s = parseFloat(score);
            if (s >= 90) return 'score-excellent';
            if (s >= 70) return 'score-good';
            if (s >= 50) return 'score-average';
            return 'score-poor';
        }

        function clearHistory() {
            if (confirm(translations[currentLanguage].confirmClearHistory)) {
                quizHistory = [];
                saveToStorage(STORAGE_KEYS.HISTORY, []);
                displayStatistics();
            }
        }

        // Translations
        const translations = {
            vi: {
                title: 'üìù BlueQuiz',
                subtitle: 'T·∫°o b·ªô c√¢u h·ªèi, x√°o tr·ªôn v√† ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông',
                step1: 'B∆∞·ªõc 1: Nh·∫≠p D·ªØ Li·ªáu',
                step2: 'B∆∞·ªõc 2: L√†m B√†i Quiz',
                questionsLabel: 'C√¢u h·ªèi v√† ƒë√°p √°n:',
                questionsPlaceholder: 'Nh·∫≠p c√¢u h·ªèi theo ƒë·ªãnh d·∫°ng:\n\n1. C√¢u h·ªèi th·ª© nh·∫•t?\na. ƒê√°p √°n A\nb. ƒê√°p √°n B\nc. ƒê√°p √°n C\nd. ƒê√°p √°n D\n\n2. C√¢u h·ªèi th·ª© hai?\na. ƒê√°p √°n A\nb. ƒê√°p √°n B\nc. ƒê√°p √°n C\nd. ƒê√°p √°n D',
                questionsHint: 'M·ªói c√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng s·ªë th·ª© t·ª±, c√°c ƒë√°p √°n b·∫Øt ƒë·∫ßu b·∫±ng a, b, c, d...',
                importFileBtn: 'Import t·ª´ file',
                addImageBtn: 'Th√™m ·∫£nh',
                exportTxtBtn: 'Export TXT',
                exportExcelBtn: 'Export Excel',
                uploadHint: 'H·ªó tr·ª£: Excel (.xlsx, .xls), Word (.docx), Text (.txt)',
                imageHint: 'Th√™m ·∫£nh: Ch·ªçn ·∫£nh t·ª´ m√°y t√≠nh, tag [IMG:...] s·∫Ω ƒë∆∞·ª£c th√™m v√†o v·ªã tr√≠ con tr·ªè',
                answersLabel: 'ƒê√°p √°n ƒë√∫ng:',
                answersPlaceholder: 'Nh·∫≠p ƒë√°p √°n theo ƒë·ªãnh d·∫°ng:\n\n1. a\n2. b\n3. c\n4. d\n\nNhi·ªÅu ƒë√°p √°n ƒë√∫ng:\n5. a,b,c\n6. abc',
                answersHint: 'Nh·∫≠p ƒë√°p √°n ƒë√∫ng cho m·ªói c√¢u. Nhi·ªÅu ƒë√°p √°n: d√πng d·∫•u ph·∫©y (a,b,c) ho·∫∑c vi·∫øt li·ªÅn (abc)',
                questionCountLabel: 'S·ªë c√¢u h·ªèi:',
                questionCountHint: '(ƒê·ªÉ tr·ªëng = t·∫•t c·∫£)',
                questionOrderLabel: 'Th·ª© t·ª± c√¢u h·ªèi:',
                orderSequential: 'Tr√¨nh t·ª±',
                orderRandom: 'Ng·∫´u nhi√™n',
                shuffleLabel: 'X√°o tr·ªôn c√¢u h·ªèi',
                createQuizBtn: 'T·∫°o Quiz',
                filterLabel: 'L·ªçc c√¢u h·ªèi:',
                filterAll: 'T·∫•t c·∫£',
                filterPinned: 'C√¢u ƒë√£ pin',
                filterIncorrect: 'C√¢u sai',
                submitBtn: 'Ch·∫•m ƒêi·ªÉm',
                backToEditBtn: '‚¨ÖÔ∏è Quay L·∫°i',
                restartBtn: 'üîÑ L√†m L·∫°i',
                retryAllBtn: 'üîÑ L√†m L·∫°i T·∫•t C·∫£',
                retryIncorrectBtn: 'L√†m L·∫°i C√¢u Sai',
                retryPinnedBtn: 'L√†m L·∫°i C√¢u ƒê√£ Pin',
                questionNavigator: 'Danh S√°ch C√¢u H·ªèi',
                timeRemaining: 'Th·ªùi gian c√≤n l·∫°i:',
                pauseTimer: 'T·∫°m d·ª´ng',
                resumeTimer: 'Ti·∫øp t·ª•c',
                confirmBackToEdit: 'B·∫°n c√≥ ch·∫Øc mu·ªën quay l·∫°i? Ti·∫øn tr√¨nh l√†m b√†i s·∫Ω KH√îNG ƒë∆∞·ª£c l∆∞u.',
                confirmRestart: 'B·∫°n c√≥ ch·∫Øc mu·ªën l√†m l·∫°i? B√†i l√†m hi·ªán t·∫°i s·∫Ω b·ªã x√≥a.',
                question: 'C√¢u',
                pinQuestion: 'Pin c√¢u h·ªèi',
                unpinQuestion: 'B·ªè pin',
                correct: '‚úì Ch√≠nh x√°c!',
                incorrect: '‚úó Sai - ƒê√°p √°n ƒë√∫ng:',
                unanswered: 'Ch∆∞a tr·∫£ l·ªùi - ƒê√°p √°n ƒë√∫ng:',
                resultTitle: 'üéâ K·∫øt Qu·∫£ C·ªßa B·∫°n',
                totalQuestions: 'T·ªïng c√¢u',
                correctAnswers: 'ƒê√∫ng',
                incorrectAnswers: 'Sai',
                unansweredQuestions: 'Ch∆∞a tr·∫£ l·ªùi',
                alertNoData: 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß c√¢u h·ªèi v√† ƒë√°p √°n!',
                alertNoQuestions: 'Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi h·ª£p l·ªá! Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng.',
                alertNoIncorrect: 'Kh√¥ng c√≥ c√¢u sai n√†o ƒë·ªÉ l√†m l·∫°i!',
                alertNoPinned: 'Ch∆∞a c√≥ c√¢u h·ªèi n√†o ƒë∆∞·ª£c pin!',
                alertNoRetry: 'Kh√¥ng c√≥ c√¢u h·ªèi n√†o ƒë·ªÉ l√†m l·∫°i!',
                aiPromptsTitle: 'H∆∞·ªõng D·∫´n T·∫°o C√¢u H·ªèi V·ªõi AI Chatbot',
                aiPromptsDesc: 'Copy c√°c prompt sau v√† paste v√†o ChatGPT, Claude, ho·∫∑c AI chatbot kh√°c ƒë·ªÉ t·ª± ƒë·ªông t·∫°o c√¢u h·ªèi ƒë√∫ng format:',
                quickTemplatesTitle: 'üìã Ho·∫∑c Copy Template M·∫´u ƒê·ªÉ Paste Tr·ª±c Ti·∫øp:',
                templateQuestionsLabel: 'M·∫´u C√¢u H·ªèi:',
                templateAnswersLabel: 'M·∫´u ƒê√°p √Ån:',
                templateListItemsLabel: 'M·∫´u List Items:',
                copyBtn: 'Copy',
                copiedBtn: '‚úì ƒê√£ copy!',
                examMode: 'Ch·∫ø ƒë·ªô thi',
                enableExamMode: 'B·∫≠t ch·∫ø ƒë·ªô thi',
                hours: 'Gi·ªù:',
                minutes: 'Ph√∫t:',
                timerPanelHeader: '‚è±Ô∏è Th·ªùi Gian',
                controlPanelHeader: 'üéÆ ƒêi·ªÅu Khi·ªÉn',
                timeUp: 'H·∫øt gi·ªù! T·ª± ƒë·ªông n·ªôp b√†i...',
                examModeActive: 'Ch·∫ø ƒë·ªô thi ƒëang b·∫≠t. B·∫°n kh√¥ng th·ªÉ xem ƒë√°p √°n cho ƒë·∫øn khi h·∫øt gi·ªù ho·∫∑c n·ªôp b√†i.',
                quizManagement: 'Qu·∫£n L√Ω B·ªô Quiz',
                quizNamePlaceholder: 'Nh·∫≠p t√™n b·ªô quiz (VD: L·ªãch S·ª≠ Vi·ªát Nam, JavaScript Basics...)',
                saveQuizBtn: 'üíæ L∆∞u B·ªô Quiz',
                loadBtn: 'T·∫£i',
                deleteBtn: 'X√≥a',
                questions: 'c√¢u h·ªèi',
                savedOn: 'L∆∞u l√∫c:',
                confirmDelete: 'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b·ªô quiz n√†y?',
                alertNoQuizName: 'Vui l√≤ng nh·∫≠p t√™n b·ªô quiz!',
                alertNoData: 'Vui l√≤ng nh·∫≠p c√¢u h·ªèi v√† ƒë√°p √°n tr∆∞·ªõc khi l∆∞u!',
                alertQuizSaved: 'ƒê√£ l∆∞u b·ªô quiz th√†nh c√¥ng!',
                noSavedQuizzes: 'Ch∆∞a c√≥ b·ªô quiz n√†o ƒë∆∞·ª£c l∆∞u',
                viewStatistics: 'Xem Th·ªëng K√™',
                hideStatistics: '·∫®n Th·ªëng K√™',
                statisticsTitle: 'Th·ªëng K√™ & L·ªãch S·ª≠',
                recentHistory: 'L·ªãch S·ª≠ G·∫ßn ƒê√¢y',
                clearHistory: 'X√≥a L·ªãch S·ª≠',
                confirmClearHistory: 'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠?',
                totalAttempts: 'T·ªïng l∆∞·ª£t thi',
                averageScore: 'ƒêi·ªÉm TB',
                highestScore: 'ƒêi·ªÉm cao nh·∫•t',
                lowestScore: 'ƒêi·ªÉm th·∫•p nh·∫•t',
                date: 'Ng√†y gi·ªù',
                score: 'ƒêi·ªÉm',
                noHistory: 'Ch∆∞a c√≥ l·ªãch s·ª≠ l√†m b√†i n√†o'
            },
            en: {
                title: 'üìù BlueQuiz',
                subtitle: 'Create quizzes, shuffle questions, and auto-grade',
                step1: 'Step 1: Input Data',
                step2: 'Step 2: Take the Quiz',
                questionsLabel: 'Questions and Answers:',
                questionsPlaceholder: 'Enter questions in this format:\n\n1. First question?\na. Answer A\nb. Answer B\nc. Answer C\nd. Answer D\n\n2. Second question?\na. Answer A\nb. Answer B\nc. Answer C\nd. Answer D',
                questionsHint: 'Each question starts with a number, answers start with a, b, c, d...',
                importFileBtn: 'Import from file',
                addImageBtn: 'Add image',
                exportTxtBtn: 'Export TXT',
                exportExcelBtn: 'Export Excel',
                uploadHint: 'Supported: Excel (.xlsx, .xls), Word (.docx), Text (.txt)',
                imageHint: 'Add image: Select image from computer, [IMG:...] tag will be inserted at cursor position',
                answersLabel: 'Correct Answers:',
                answersPlaceholder: 'Enter answers in this format:\n\n1. a\n2. b\n3. c\n4. d\n\nMultiple correct answers:\n5. a,b,c\n6. abc',
                answersHint: 'Enter correct answers for each question. Multiple answers: use comma (a,b,c) or write together (abc)',
                questionCountLabel: 'Number of questions:',
                questionCountHint: '(Leave empty = all)',
                questionOrderLabel: 'Question order:',
                orderSequential: 'Sequential',
                orderRandom: 'Random',
                shuffleLabel: 'Shuffle questions',
                createQuizBtn: 'Create Quiz',
                filterLabel: 'Filter questions:',
                filterAll: 'All',
                filterPinned: 'Pinned',
                filterIncorrect: 'Incorrect',
                submitBtn: 'Submit & Grade',
                backToEditBtn: '‚¨ÖÔ∏è Back',
                restartBtn: 'üîÑ Restart',
                retryAllBtn: 'üîÑ Retry All Questions',
                retryIncorrectBtn: 'Retry Incorrect',
                retryPinnedBtn: 'Retry Pinned',
                questionNavigator: 'Question List',
                timeRemaining: 'Time Remaining:',
                pauseTimer: 'Pause',
                resumeTimer: 'Resume',
                confirmBackToEdit: 'Are you sure you want to go back? Your progress will NOT be saved.',
                confirmRestart: 'Are you sure you want to restart? Your current answers will be cleared.',
                question: 'Question',
                pinQuestion: 'Pin question',
                unpinQuestion: 'Unpin',
                correct: '‚úì Correct!',
                incorrect: '‚úó Incorrect - Correct answer:',
                unanswered: 'Not answered - Correct answer:',
                resultTitle: 'üéâ Your Results',
                totalQuestions: 'Total',
                correctAnswers: 'Correct',
                incorrectAnswers: 'Incorrect',
                unansweredQuestions: 'Not Answered',
                alertNoData: 'Please enter both questions and answers!',
                alertNoQuestions: 'No valid questions found! Please check the format.',
                alertNoIncorrect: 'No incorrect questions to retry!',
                alertNoPinned: 'No questions have been pinned yet!',
                alertNoRetry: 'No questions to retry!',
                aiPromptsTitle: 'Generate Questions With AI Chatbot',
                aiPromptsDesc: 'Copy these prompts and paste into ChatGPT, Claude, or other AI chatbots to automatically generate questions in the correct format:',
                quickTemplatesTitle: 'üìã Or Copy Sample Templates to Paste Directly:',
                templateQuestionsLabel: 'Questions Template:',
                templateAnswersLabel: 'Answers Template:',
                templateListItemsLabel: 'List Items Template:',
                copyBtn: 'Copy',
                copiedBtn: '‚úì Copied!',
                examMode: 'Exam Mode',
                enableExamMode: 'Enable exam mode',
                hours: 'Hours:',
                minutes: 'Minutes:',
                timerPanelHeader: '‚è±Ô∏è Timer',
                controlPanelHeader: 'üéÆ Controls',
                timeUp: 'Time\'s up! Auto-submitting...',
                examModeActive: 'Exam mode is active. You cannot see answers until time expires or you submit.',
                quizManagement: 'Quiz Management',
                quizNamePlaceholder: 'Enter quiz name (e.g., World History, JavaScript Basics...)',
                saveQuizBtn: 'üíæ Save Quiz Set',
                loadBtn: 'Load',
                deleteBtn: 'Delete',
                questions: 'questions',
                savedOn: 'Saved on:',
                confirmDelete: 'Are you sure you want to delete this quiz set?',
                alertNoQuizName: 'Please enter a quiz name!',
                alertNoData: 'Please enter questions and answers before saving!',
                alertQuizSaved: 'Quiz set saved successfully!',
                noSavedQuizzes: 'No saved quiz sets yet',
                viewStatistics: 'View Statistics',
                hideStatistics: 'Hide Statistics',
                statisticsTitle: 'Statistics & History',
                recentHistory: 'Recent History',
                clearHistory: 'Clear History',
                confirmClearHistory: 'Are you sure you want to clear all history?',
                totalAttempts: 'Total Attempts',
                averageScore: 'Avg Score',
                highestScore: 'Highest Score',
                lowestScore: 'Lowest Score',
                date: 'Date & Time',
                score: 'Score',
                noHistory: 'No quiz history yet'
            }
        };

        // Template data for quick copy
        const templates = {
            vi: {
                questions: `1. C√¢u h·ªèi th·ª© nh·∫•t?
a. ƒê√°p √°n A
b. ƒê√°p √°n B
c. ƒê√°p √°n C
d. ƒê√°p √°n D

2. C√¢u h·ªèi th·ª© hai?
a. ƒê√°p √°n A
b. ƒê√°p √°n B
c. ƒê√°p √°n C
d. ƒê√°p √°n D

3. C√¢u h·ªèi th·ª© ba (nhi·ªÅu ƒë√°p √°n ƒë√∫ng)?
a. L·ª±a ch·ªçn A
b. L·ª±a ch·ªçn B
c. L·ª±a ch·ªçn C
d. L·ª±a ch·ªçn D
e. L·ª±a ch·ªçn E`,
                answers: `1. a
2. b
3. a,c,e`,
                listItems: `C√°c ho·∫°t ƒë·ªông n√†o sau ƒë√¢y l√† ch√≠nh trong quy tr√¨nh review?
- 1. L·∫≠p k·∫ø ho·∫°ch
- 2. Review c√° nh√¢n
- 3. H·ªçp nh√≥m
- 4. S·ª≠a l·ªói
- 5. T√†i li·ªáu h√≥a
- 6. Ki·ªÉm th·ª≠

A. 1, 2, 4
B. 2, 3, 5
C. 1, 2, 3, 4
D. T·∫•t c·∫£ c√°c m·ª•c`
            },
            en: {
                questions: `1. First question?
a. Answer A
b. Answer B
c. Answer C
d. Answer D

2. Second question?
a. Answer A
b. Answer B
c. Answer C
d. Answer D

3. Third question (multiple correct answers)?
a. Option A
b. Option B
c. Option C
d. Option D
e. Option E`,
                answers: `1. a
2. b
3. a,c,e`,
                listItems: `Which of the following are main activities in the review process?
- 1. Planning
- 2. Individual review
- 3. Team meeting
- 4. Code fixing
- 5. Documentation
- 6. Testing

A. 1, 2, 4
B. 2, 3, 5
C. 1, 2, 3, 4
D. All items`
            }
        };

        // AI Prompts templates
        const aiPrompts = {
            vi: [
                {
                    title: 'üìö T·∫°o B·ªô C√¢u H·ªèi V·ªÅ Ch·ªß ƒê·ªÅ B·∫•t K·ª≥',
                    description: 'T·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám v·ªÅ ch·ªß ƒë·ªÅ b·∫°n mu·ªën h·ªçc',
                    prompt: `H√£y t·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám v·ªÅ [TOPIC] theo ƒë·ªãnh d·∫°ng sau:

1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]

Sau ƒë√≥, cung c·∫•p ƒë√°p √°n ƒë√∫ng theo format:
1. [ƒë√°p √°n ƒë√∫ng]

V√≠ d·ª•:
1. Python l√† ng√¥n ng·ªØ l·∫≠p tr√¨nh g√¨?
a. Compiled
b. Interpreted
c. Assembly
d. Machine code

ƒê√°p √°n:
1. b

[Thay TOPIC b·∫±ng ch·ªß ƒë·ªÅ c·ªßa b·∫°n, v√≠ d·ª•: L·ªãch s·ª≠ Vi·ªát Nam, To√°n h·ªçc l·ªõp 10, JavaScript, etc.]`
                },
                {
                    title: 'üéì √în T·∫≠p K·ª≥ Thi',
                    description: 'T·∫°o c√¢u h·ªèi √¥n t·∫≠p d·ª±a tr√™n n·ªôi dung c·ª• th·ªÉ',
                    prompt: `D·ª±a tr√™n n·ªôi dung sau ƒë√¢y, t·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám:

[PASTE CONTENT ·ªû ƒê√ÇY]

ƒê·ªãnh d·∫°ng c√¢u h·ªèi:
1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]

ƒê·ªãnh d·∫°ng ƒë√°p √°n:
1. [a/b/c/d]

L∆∞u √Ω:
- C√¢u h·ªèi ph·∫£i ki·ªÉm tra s·ª± hi·ªÉu bi·∫øt, kh√¥ng ch·ªâ ghi nh·ªõ
- C√°c ƒë√°p √°n sai ph·∫£i h·ª£p l√Ω v√† g√¢y nh·∫ßm l·∫´n
- ƒê·∫£m b·∫£o ch·ªâ c√≥ 1 ƒë√°p √°n ƒë√∫ng`
                },
                {
                    title: 'üí° C√¢u H·ªèi Nhi·ªÅu ƒê√°p √Ån ƒê√∫ng',
                    description: 'T·∫°o c√¢u h·ªèi c√≥ nhi·ªÅu ƒë√°p √°n ƒë√∫ng (checkbox)',
                    prompt: `T·∫°o 5 c√¢u h·ªèi v·ªÅ [TOPIC] m√† m·ªói c√¢u c√≥ NHI·ªÄU ƒë√°p √°n ƒë√∫ng:

ƒê·ªãnh d·∫°ng c√¢u h·ªèi:
1. [C√¢u h·ªèi] (ch·ªçn t·∫•t c·∫£ ƒë√°p √°n ƒë√∫ng)
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]
e. [ƒê√°p √°n E]

ƒê·ªãnh d·∫°ng ƒë√°p √°n (nhi·ªÅu ƒë√°p √°n ƒë√∫ng):
1. a,c,e
ho·∫∑c
1. ace

V√≠ d·ª•:
1. Ng√¥n ng·ªØ n√†o sau ƒë√¢y h·ªó tr·ª£ l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng?
a. Python
b. Java
c. C
d. JavaScript
e. Assembly

ƒê√°p √°n:
1. a,b,d`
                },
                {
                    title: 'üåç H·ªçc Ngo·∫°i Ng·ªØ',
                    description: 'T·∫°o b√†i t·∫≠p t·ª´ v·ª±ng v√† ng·ªØ ph√°p',
                    prompt: `T·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám h·ªçc [NG√îN NG·ªÆ]:

5 c√¢u ƒë·∫ßu: T·ª´ v·ª±ng (nghƒ©a c·ªßa t·ª´)
5 c√¢u sau: Ng·ªØ ph√°p (ƒëi·ªÅn t·ª´ ƒë√∫ng v√†o ch·ªó tr·ªëng)

ƒê·ªãnh d·∫°ng:
1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]

ƒê√°p √°n:
1. [a/b/c/d]

V√≠ d·ª• v·ªÅ t·ª´ v·ª±ng:
1. "Beautiful" c√≥ nghƒ©a l√† g√¨?
a. X·∫•u
b. ƒê·∫πp
c. T·ªët
d. Cao

V√≠ d·ª• v·ªÅ ng·ªØ ph√°p:
2. She ___ to school every day.
a. go
b. goes
c. going
d. went

ƒê√°p √°n:
1. b
2. b`
                },
                {
                    title: 'üß™ Khoa H·ªçc & C√¥ng Ngh·ªá',
                    description: 'C√¢u h·ªèi khoa h·ªçc v·ªõi nhi·ªÅu l·ª±a ch·ªçn',
                    prompt: `T·∫°o 10 c√¢u h·ªèi khoa h·ªçc v·ªÅ [TOPIC] v·ªõi 5-6 l·ª±a ch·ªçn cho m·ªói c√¢u:

ƒê·ªãnh d·∫°ng:
1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]
e. [ƒê√°p √°n E]
f. [ƒê√°p √°n F] (n·∫øu c·∫ßn)

ƒê√°p √°n:
1. [a/b/c/d/e/f]

Y√™u c·∫ßu:
- ƒê·ªô kh√≥: trung b√¨nh ƒë·∫øn kh√≥
- Bao g·ªìm c·∫£ c√¢u h·ªèi l√Ω thuy·∫øt v√† ·ª©ng d·ª•ng
- ƒê√°p √°n sai ph·∫£i h·ª£p l√Ω v·ªÅ m·∫∑t khoa h·ªçc`
                },
                {
                    title: 'üìã C√¢u H·ªèi V·ªõi Danh S√°ch (List Items)',
                    description: 'T·∫°o c√¢u h·ªèi c√≥ danh s√°ch m·ª•c li·ªát k√™',
                    prompt: `T·∫°o 5 c√¢u h·ªèi v·ªÅ [TOPIC] v·ªõi danh s√°ch c√°c m·ª•c ƒë∆∞·ª£c li·ªát k√™:

ƒê·ªãnh d·∫°ng:
[C√¢u h·ªèi]?
- 1. [M·ª•c th·ª© nh·∫•t]
- 2. [M·ª•c th·ª© hai]
- 3. [M·ª•c th·ª© ba]
- 4. [M·ª•c th·ª© t∆∞]
- 5. [M·ª•c th·ª© nƒÉm]
- 6. [M·ª•c th·ª© s√°u]

A. 1, 2, 4
B. 2, 3, 5
C. 1, 3, 4, 6
D. T·∫•t c·∫£ c√°c m·ª•c

L∆∞u √Ω QUAN TR·ªåNG:
- S·ª≠ d·ª•ng CH·ªÆ HOA (A, B, C, D) cho c√°c l·ª±a ch·ªçn khi c√≥ danh s√°ch li·ªát k√™
- M·ªói l·ª±a ch·ªçn tham chi·∫øu ƒë·∫øn c√°c s·ªë trong danh s√°ch
- C√¢u h·ªèi v√† danh s√°ch li·ªát k√™ tr∆∞·ªõc, sau ƒë√≥ m·ªõi ƒë·∫øn c√°c l·ª±a ch·ªçn A, B, C, D

V√≠ d·ª•:
Which of the following are main activities of code review?
- 1. Planning
- 2. Individual review
- 3. Team meeting
- 4. Code fixing
- 5. Documentation
- 6. Testing

A. 1, 2, 4
B. 2, 3, 5
C. 1, 2, 3, 4
D. All items

ƒê√°p √°n:
1. C`
                }
            ],
            en: [
                {
                    title: 'üìö Create Quiz on Any Topic',
                    description: 'Generate 10 multiple choice questions about any subject',
                    prompt: `Create 10 multiple choice questions about [TOPIC] in this format:

1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]

Then provide correct answers in this format:
1. [correct answer]

Example:
1. What type of programming language is Python?
a. Compiled
b. Interpreted
c. Assembly
d. Machine code

Answers:
1. b

[Replace TOPIC with your subject, e.g.: World History, Calculus, JavaScript, etc.]`
                },
                {
                    title: 'üéì Exam Review',
                    description: 'Create review questions based on specific content',
                    prompt: `Based on the following content, create 10 multiple choice questions:

[PASTE CONTENT HERE]

Question format:
1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]

Answer format:
1. [a/b/c/d]

Note:
- Questions should test understanding, not just memorization
- Wrong answers should be plausible and challenging
- Ensure only one correct answer`
                },
                {
                    title: 'üí° Multiple Correct Answers',
                    description: 'Create questions with multiple correct answers (checkbox)',
                    prompt: `Create 5 questions about [TOPIC] where each has MULTIPLE correct answers:

Question format:
1. [Question] (select all that apply)
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]
e. [Answer E]

Answer format (multiple correct):
1. a,c,e
or
1. ace

Example:
1. Which languages support object-oriented programming?
a. Python
b. Java
c. C
d. JavaScript
e. Assembly

Answers:
1. a,b,d`
                },
                {
                    title: 'üåç Language Learning',
                    description: 'Create vocabulary and grammar exercises',
                    prompt: `Create 10 multiple choice questions for learning [LANGUAGE]:

First 5: Vocabulary (word meanings)
Last 5: Grammar (fill in the blank)

Format:
1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]

Answers:
1. [a/b/c/d]

Vocabulary example:
1. What does "Beautiful" mean?
a. Ugly
b. Pretty
c. Good
d. Tall

Grammar example:
2. She ___ to school every day.
a. go
b. goes
c. going
d. went

Answers:
1. b
2. b`
                },
                {
                    title: 'üß™ Science & Technology',
                    description: 'Science questions with more options',
                    prompt: `Create 10 science questions about [TOPIC] with 5-6 options each:

Format:
1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]
e. [Answer E]
f. [Answer F] (if needed)

Answers:
1. [a/b/c/d/e/f]

Requirements:
- Difficulty: medium to hard
- Include both theoretical and applied questions
- Wrong answers should be scientifically plausible`
                },
                {
                    title: 'üìã Questions With List Items',
                    description: 'Create questions with enumerated list items',
                    prompt: `Create 5 questions about [TOPIC] with numbered list items:

Format:
[Question]?
- 1. [First item]
- 2. [Second item]
- 3. [Third item]
- 4. [Fourth item]
- 5. [Fifth item]
- 6. [Sixth item]

A. 1, 2, 4
B. 2, 3, 5
C. 1, 3, 4, 6
D. All items

IMPORTANT Notes:
- Use UPPERCASE letters (A, B, C, D) for options when using list items
- Each option references numbers from the list
- Question and list items come first, then options A, B, C, D

Example:
Which of the following are main activities of code review?
- 1. Planning
- 2. Individual review
- 3. Team meeting
- 4. Code fixing
- 5. Documentation
- 6. Testing

A. 1, 2, 4
B. 2, 3, 5
C. 1, 2, 3, 4
D. All items

Answers:
1. C`
                }
            ]
        };

        function changeLanguage(lang) {
            currentLanguage = lang;
            saveLanguage(lang); // Save language preference

            // Update language button active state
            document.querySelectorAll('.language-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeButton = lang === 'vi' ? document.getElementById('langVi') : document.getElementById('langEn');
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // Update all elements with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });

            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });

            // Update pin button titles if quiz is displayed
            if (!document.getElementById('quizSection').classList.contains('hidden')) {
                quizData.forEach((q, index) => {
                    const originalNumber = questionMapping[index];
                    const isPinned = pinnedQuestions.has(originalNumber);
                    const pinButton = document.getElementById(`pin${index}`);
                    if (pinButton) {
                        pinButton.title = isPinned ? translations[lang].unpinQuestion : translations[lang].pinQuestion;
                    }
                });
            }

            // Update result section if it exists
            if (isGraded && !document.getElementById('resultSection').classList.contains('hidden')) {
                // Re-display results with new language
                const resultDiv = document.getElementById('resultSection');
                if (resultDiv.innerHTML) {
                    // Results will be updated on next submit
                }
            }

            // Re-render AI prompts with new language
            renderAIPrompts();

            // Update templates
            updateTemplates();

            // Update saved quizzes display
            displaySavedQuizzes();
        }

        function updateTemplates() {
            const questionsTemplate = document.getElementById('questionsTemplate');
            const answersTemplate = document.getElementById('answersTemplate');
            const listItemsTemplate = document.getElementById('listItemsTemplate');

            if (questionsTemplate && answersTemplate) {
                questionsTemplate.textContent = templates[currentLanguage].questions;
                answersTemplate.textContent = templates[currentLanguage].answers;
            }

            if (listItemsTemplate) {
                listItemsTemplate.textContent = templates[currentLanguage].listItems;
            }
        }

        // Initialize language on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData(); // Load saved data from localStorage
            changeLanguage(currentLanguage); // Use saved language or default
            renderAIPrompts();
            displaySavedQuizzes(); // Display saved quiz sets

            // Add auto-save event listeners
            const questionsInput = document.getElementById('questionsInput');
            const answersInput = document.getElementById('answersInput');

            // Auto-save on input with debounce
            let questionsSaveTimer;
            let answersSaveTimer;

            questionsInput.addEventListener('input', function() {
                clearTimeout(questionsSaveTimer);
                questionsSaveTimer = setTimeout(autoSaveQuestions, 1000);
            });

            answersInput.addEventListener('input', function() {
                clearTimeout(answersSaveTimer);
                answersSaveTimer = setTimeout(autoSaveAnswers, 1000);
            });

            // Also save on blur (when user clicks away)
            questionsInput.addEventListener('blur', autoSaveQuestions);
            answersInput.addEventListener('blur', autoSaveAnswers);
        });

        function toggleAIPrompts() {
            const content = document.getElementById('aiPromptsContent');
            const icon = document.getElementById('toggleIcon');

            content.classList.toggle('expanded');
            icon.classList.toggle('rotated');
        }

        function renderAIPrompts() {
            const container = document.getElementById('promptsContainer');
            const prompts = aiPrompts[currentLanguage];

            container.innerHTML = prompts.map((prompt, index) => `
                <div class="prompt-card">
                    <h4>${prompt.title}</h4>
                    <p>${prompt.description}</p>
                    <div class="prompt-text" id="prompt${index}">${prompt.prompt}</div>
                    <button class="copy-btn" onclick="copyPrompt(${index})" id="copyBtn${index}">
                        <span>${translations[currentLanguage].copyBtn}</span>
                    </button>
                </div>
            `).join('');
        }

        function copyPrompt(index) {
            const promptText = aiPrompts[currentLanguage][index].prompt;
            const button = document.getElementById(`copyBtn${index}`);

            navigator.clipboard.writeText(promptText).then(() => {
                button.classList.add('copied');
                button.innerHTML = `<span>${translations[currentLanguage].copiedBtn}</span>`;

                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = `<span>${translations[currentLanguage].copyBtn}</span>`;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.');
            });
        }

        function copyTemplate(type) {
            const templateText = templates[currentLanguage][type];
            const button = document.getElementById(`copy${type.charAt(0).toUpperCase() + type.slice(1)}Btn`);

            navigator.clipboard.writeText(templateText).then(() => {
                const originalHTML = button.innerHTML;
                button.classList.add('copied');
                button.innerHTML = `<span>${translations[currentLanguage].copiedBtn}</span>`;

                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = originalHTML;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.');
            });
        }

        function parseQuestions(text) {
            const questions = [];
            const lines = text.trim().split('\n');
            let currentQuestion = null;
            let questionNumber = 0;

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                // Format 1: C√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng s·ªë (1. 2. 3.)
                const numberedQuestionMatch = line.match(/^(\d+)\.\s*(.+)/);
                if (numberedQuestionMatch) {
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    questionNumber = parseInt(numberedQuestionMatch[1]);
                    currentQuestion = {
                        number: questionNumber,
                        question: numberedQuestionMatch[2],
                        options: []
                    };
                    continue;
                }

                // Ki·ªÉm tra d√≤ng ƒë√°p √°n (a. b. c. ho·∫∑c A. B. C.)
                const optionMatch = line.match(/^([a-zA-Z])\.\s*(.+)/);
                if (optionMatch && currentQuestion) {
                    currentQuestion.options.push({
                        letter: optionMatch[1].toLowerCase(),
                        text: optionMatch[2]
                    });
                    continue;
                }

                // Format 2: C√¢u h·ªèi kh√¥ng c√≥ s·ªë (d√≤ng text, th∆∞·ªùng k·∫øt th√∫c b·∫±ng ?)
                // Ch·ªâ coi l√† c√¢u h·ªèi m·ªõi n·∫øu ch∆∞a c√≥ currentQuestion ho·∫∑c ƒë√£ c√≥ ƒë√°p √°n
                if (line.includes('?') && (!currentQuestion || currentQuestion.options.length > 0)) {
                    if (currentQuestion && currentQuestion.options.length > 0) {
                        questions.push(currentQuestion);
                    }
                    questionNumber++;
                    currentQuestion = {
                        number: questionNumber,
                        question: line,
                        options: []
                    };
                    continue;
                }

                // C√°c d√≤ng kh√°c (list items: - 1., - I., etc) -> append v√†o c√¢u h·ªèi
                if (currentQuestion && currentQuestion.options.length === 0) {
                    currentQuestion.question += '\n' + line;
                }
            }

            if (currentQuestion && currentQuestion.options.length > 0) {
                questions.push(currentQuestion);
            }

            return questions;
        }

        function parseAnswers(text) {
            const answers = {};
            const lines = text.trim().split(/[\n]+/);

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                // Match pattern: 1. a ho·∫∑c 1. a,b,c ho·∫∑c 1. abc ho·∫∑c 1.a 1.b 1.c
                const match = line.match(/^(\d+)\.\s*(.+)/);
                if (match) {
                    const questionNum = parseInt(match[1]);
                    let answerPart = match[2].trim();

                    // X·ª≠ l√Ω c√°c format: "a,b,c" ho·∫∑c "abc" ho·∫∑c "a b c"
                    answerPart = answerPart.replace(/\s+/g, ''); // Remove spaces

                    // N·∫øu c√≥ d·∫•u ph·∫©y, split by comma
                    if (answerPart.includes(',')) {
                        answers[questionNum] = answerPart.split(',').map(a => a.toLowerCase().trim());
                    } else if (answerPart.length > 1 && /^[a-z]+$/i.test(answerPart)) {
                        // N·∫øu l√† chu·ªói nhi·ªÅu ch·ªØ c√°i li√™n ti·∫øp (abc)
                        answers[questionNum] = answerPart.toLowerCase().split('');
                    } else {
                        // ƒê√°p √°n ƒë∆°n
                        answers[questionNum] = answerPart.toLowerCase();
                    }
                }
            }

            return answers;
        }

        function isMultipleAnswer(questionNumber) {
            const answer = correctAnswers[questionNumber];
            return Array.isArray(answer);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function generateQuiz(specificQuestions = null) {
            let questionsText, answersText;

            if (specificQuestions) {
                // T·∫°o quiz t·ª´ c√¢u h·ªèi c·ª• th·ªÉ (pin ho·∫∑c sai)
                questionsText = originalQuestionsText;
                answersText = originalAnswersText;
            } else {
                // T·∫°o quiz m·ªõi t·ª´ input
                questionsText = document.getElementById('questionsInput').value;
                answersText = document.getElementById('answersInput').value;
                originalQuestionsText = questionsText;
                originalAnswersText = answersText;
                pinnedQuestions.clear();
                incorrectQuestions.clear();
                isGraded = false;
            }

            const shouldShuffle = document.getElementById('shuffleCheckbox').checked;

            if (!questionsText.trim() || !answersText.trim()) {
                alert(translations[currentLanguage].alertNoData);
                return;
            }

            // Parse d·ªØ li·ªáu
            let allQuestions = parseQuestions(questionsText);
            correctAnswers = parseAnswers(answersText);

            if (allQuestions.length === 0) {
                alert(translations[currentLanguage].alertNoQuestions);
                return;
            }

            // L·ªçc c√¢u h·ªèi n·∫øu c√≥ specificQuestions
            if (specificQuestions) {
                quizData = allQuestions.filter(q => specificQuestions.has(q.number));
                if (quizData.length === 0) {
                    alert(translations[currentLanguage].alertNoRetry);
                    return;
                }
            } else {
                quizData = allQuestions;

                // √Åp d·ª•ng th·ª© t·ª± c√¢u h·ªèi (random/sequential)
                const questionOrder = document.querySelector('input[name="questionOrder"]:checked')?.value || 'sequential';
                if (questionOrder === 'random' || shouldShuffle) {
                    quizData = shuffleArray([...quizData]);
                }

                // √Åp d·ª•ng s·ªë l∆∞·ª£ng c√¢u h·ªèi
                const questionCountInput = document.getElementById('questionCount');
                const questionCount = parseInt(questionCountInput?.value);
                if (questionCount && questionCount > 0 && questionCount < quizData.length) {
                    quizData = quizData.slice(0, questionCount);
                }
            }

            // T·∫°o mapping
            questionMapping = {};
            quizData.forEach((q, index) => {
                questionMapping[index] = q.number;
            });

            // Reset tr·∫°ng th√°i
            isGraded = false;
            document.getElementById('retryIncorrectBtn').classList.add('hidden');
            document.getElementById('retryPinnedBtn').classList.add('hidden');
            document.getElementById('filterSection').style.display = 'none';

            // Start timer if exam mode is enabled
            if (examModeEnabled) {
                // Stop any existing timer first to prevent multiple intervals
                stopTimer();
                const hours = parseInt(document.getElementById('timerHours').value) || 0;
                const minutes = parseInt(document.getElementById('timerMinutes').value) || 30;
                timeRemaining = (hours * 3600) + (minutes * 60);
                startTimer();
            }

            // Hi·ªÉn th·ªã quiz
            displayQuiz();
            document.getElementById('inputSection').classList.add('hidden');
            document.getElementById('quizSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('hidden');
        }

        // Parse [IMG:...] tags and convert to HTML <img> tags
        function parseQuestionImages(questionText) {
            // Replace [IMGx:filename] placeholders with actual images from storage
            let result = questionText.replace(/\[(IMG\d+):[^\]]+\]/g, (match, imageId) => {
                const base64 = imageStorage[imageId];
                if (base64) {
                    return `<img src="${base64}" class="question-image" alt="Question image" onclick="openImageModal(this.src)" />`;
                }
                return match; // Keep original if not found
            });

            // Also support old format [IMG:data:image...] for backward compatibility
            result = result.replace(/\[IMG:(data:image[^\]]+)\]/g, (match, src) => {
                return `<img src="${src}" class="question-image" alt="Question image" onclick="openImageModal(this.src)" />`;
            });

            return result;
        }

        // Open image in modal for full-size viewing
        function openImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'flex';
            modalImg.src = imageSrc;
            document.body.style.overflow = 'hidden'; // Prevent background scroll
        }

        // Close image modal
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function displayQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';

            quizData.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.id = `card${index}`;

                // Check n·∫øu c√¢u n√†y ƒë√£ ƒë∆∞·ª£c pin
                const originalNumber = q.number;
                const isPinned = pinnedQuestions.has(originalNumber);
                const isIncorrect = incorrectQuestions.has(originalNumber);

                if (isPinned) {
                    questionCard.classList.add('pinned');
                }

                // Parse images in question text
                const questionWithImages = parseQuestionImages(q.question);

                let html = `
                    <div class="question-header-container">
                        <div class="question-header">${translations[currentLanguage].question} ${index + 1}</div>
                        <button class="pin-button ${isPinned ? 'pinned' : 'unpinned'}"
                                onclick="togglePin(${index})"
                                id="pin${index}"
                                title="${isPinned ? translations[currentLanguage].unpinQuestion : translations[currentLanguage].pinQuestion}">
                            ${isPinned ? 'üìå' : 'üìç'}
                        </button>
                    </div>
                    <div class="question-text">${questionWithImages}</div>
                    <div class="options">
                `;

                const isMultiple = isMultipleAnswer(originalNumber);
                const inputType = isMultiple ? 'checkbox' : 'radio';

                q.options.forEach(option => {
                    html += `
                        <div class="option">
                            <input type="${inputType}"
                                   name="question${index}"
                                   value="${option.letter}"
                                   id="q${index}_${option.letter}">
                            <label for="q${index}_${option.letter}">
                                ${option.letter.toUpperCase()}. ${option.text}
                            </label>
                        </div>
                    `;
                });

                html += `
                    </div>
                    <div class="question-result hidden" id="result${index}"></div>
                `;

                questionCard.innerHTML = html;
                container.appendChild(questionCard);
            });

            // Generate question navigator
            generateQuestionNavigator();

            // Setup answer change listeners
            setupAnswerListeners();

            // Enable inputs when displaying quiz (in case coming from retry)
            enableQuizInputs();

            // Scroll to top of quiz section
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function togglePin(index) {
            const originalNumber = questionMapping[index];
            const pinButton = document.getElementById(`pin${index}`);
            const card = document.getElementById(`card${index}`);

            if (pinnedQuestions.has(originalNumber)) {
                pinnedQuestions.delete(originalNumber);
                pinButton.classList.remove('pinned');
                pinButton.classList.add('unpinned');
                pinButton.textContent = 'üìç';
                pinButton.title = translations[currentLanguage].pinQuestion;
                card.classList.remove('pinned');
            } else {
                pinnedQuestions.add(originalNumber);
                pinButton.classList.remove('unpinned');
                pinButton.classList.add('pinned');
                pinButton.textContent = 'üìå';
                pinButton.title = translations[currentLanguage].unpinQuestion;
                card.classList.add('pinned');
            }

            // Save pinned questions to localStorage
            savePinnedQuestions();

            // Update navigator to show pinned status
            updateQuestionNavigator();

            // Update button visibility
            updateRetryButtons();
        }

        function submitQuiz() {
            // Stop timer if exam mode is active but keep exam mode enabled for restart
            if (examModeEnabled) {
                stopTimer();
            }

            let correctCount = 0;
            let incorrectCount = 0;
            let unanswered = 0;

            // Clear previous incorrect questions
            incorrectQuestions.clear();

            quizData.forEach((q, index) => {
                const originalNumber = questionMapping[index];
                const resultDiv = document.getElementById(`result${index}`);
                resultDiv.classList.remove('hidden');

                const isMultiple = isMultipleAnswer(originalNumber);
                let userAnswer;
                let isCorrect = false;

                if (isMultiple) {
                    // Checkbox - multiple answers
                    const selectedOptions = document.querySelectorAll(`input[name="question${index}"]:checked`);
                    if (selectedOptions.length === 0) {
                        userAnswer = null;
                    } else {
                        userAnswer = Array.from(selectedOptions).map(opt => opt.value).sort();
                        const correctAnswer = correctAnswers[originalNumber].slice().sort();

                        // So s√°nh arrays
                        isCorrect = userAnswer.length === correctAnswer.length &&
                                   userAnswer.every((val, idx) => val === correctAnswer[idx]);
                    }
                } else {
                    // Radio - single answer
                    const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                    if (!selectedOption) {
                        userAnswer = null;
                    } else {
                        userAnswer = selectedOption.value;
                        isCorrect = userAnswer === correctAnswers[originalNumber];
                    }
                }

                // Display result
                if (userAnswer === null) {
                    const correctAnswerDisplay = Array.isArray(correctAnswers[originalNumber])
                        ? correctAnswers[originalNumber].map(a => a.toUpperCase()).join(', ')
                        : correctAnswers[originalNumber].toUpperCase();
                    resultDiv.className = 'question-result incorrect';
                    resultDiv.textContent = `${translations[currentLanguage].unanswered} ${correctAnswerDisplay}`;
                    unanswered++;
                    incorrectCount++;
                    incorrectQuestions.add(originalNumber);
                } else if (isCorrect) {
                    resultDiv.className = 'question-result correct';
                    resultDiv.textContent = translations[currentLanguage].correct;
                    correctCount++;
                } else {
                    const correctAnswerDisplay = Array.isArray(correctAnswers[originalNumber])
                        ? correctAnswers[originalNumber].map(a => a.toUpperCase()).join(', ')
                        : correctAnswers[originalNumber].toUpperCase();
                    resultDiv.className = 'question-result incorrect';
                    resultDiv.textContent = `${translations[currentLanguage].incorrect} ${correctAnswerDisplay}`;
                    incorrectCount++;
                    incorrectQuestions.add(originalNumber);
                }
            });

            isGraded = true;
            displayResults(correctCount, incorrectCount, unanswered);
            updateRetryButtons();
            updateQuestionNavigator(); // Update navigator with results

            // Disable all inputs after grading
            disableQuizInputs();

            // Show filter section after grading
            if (isGraded) {
                document.getElementById('filterSection').style.display = 'block';
            }
        }

        function disableQuizInputs() {
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.disabled = true;
            });
        }

        function enableQuizInputs() {
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.disabled = false;
            });
        }

        function updateRetryButtons() {
            const retryAllBtn = document.getElementById('retryAllBtn');
            const retryIncorrectBtn = document.getElementById('retryIncorrectBtn');
            const retryPinnedBtn = document.getElementById('retryPinnedBtn');

            // Only show retry buttons after quiz is graded
            if (isGraded) {
                retryAllBtn.classList.remove('hidden');
            } else {
                retryAllBtn.classList.add('hidden');
            }

            if (isGraded && incorrectQuestions.size > 0) {
                retryIncorrectBtn.classList.remove('hidden');
            } else {
                retryIncorrectBtn.classList.add('hidden');
            }

            if (isGraded && pinnedQuestions.size > 0) {
                retryPinnedBtn.classList.remove('hidden');
            } else {
                retryPinnedBtn.classList.add('hidden');
            }
        }

        function displayResults(correct, incorrect, unanswered) {
            const total = quizData.length;
            const percentage = ((correct / total) * 100).toFixed(1);

            // Save to quiz history
            saveQuizHistory(percentage, total, correct, incorrect, unanswered);

            const resultSection = document.getElementById('resultSection');
            resultSection.innerHTML = `
                <h2>${translations[currentLanguage].resultTitle}</h2>
                <div class="score-display">${percentage}%</div>
                <div class="result-details">
                    <div class="result-item">
                        <h3>${translations[currentLanguage].totalQuestions}</h3>
                        <p>${total}</p>
                    </div>
                    <div class="result-item">
                        <h3>${translations[currentLanguage].correctAnswers}</h3>
                        <p style="color: #38ef7d;">${correct}</p>
                    </div>
                    <div class="result-item">
                        <h3>${translations[currentLanguage].incorrectAnswers}</h3>
                        <p style="color: #ff6b6b;">${incorrect}</p>
                    </div>
                    ${unanswered > 0 ? `
                    <div class="result-item">
                        <h3>${translations[currentLanguage].unansweredQuestions}</h3>
                        <p style="color: #ffd93d;">${unanswered}</p>
                    </div>
                    ` : ''}
                </div>
            `;
            resultSection.classList.remove('hidden');

            // Scroll to results
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function backToEdit() {
            // Confirm before going back (will NOT save progress)
            if (!confirm(translations[currentLanguage].confirmBackToEdit)) {
                return;
            }

            // Stop timer if running
            if (examModeEnabled) {
                stopTimer();
                examModeEnabled = false;
                document.getElementById('examModeCheckbox').checked = false;
                document.getElementById('fixedRightTimer').classList.remove('active');
                document.getElementById('fixedControlPanel').classList.remove('active');
                document.getElementById('timerHours').disabled = false;
                document.getElementById('timerMinutes').disabled = false;
            }

            // Hide navigator and toggle button
            const navigator = document.getElementById('questionNavigator');
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');

            navigator.classList.remove('active');
            navigator.classList.remove('open');
            sidebarToggleBtn.classList.remove('active');

            // Show input section, hide quiz and result sections
            document.getElementById('inputSection').classList.remove('hidden');
            document.getElementById('quizSection').classList.add('hidden');
            document.getElementById('resultSection').classList.add('hidden');

            // Scroll to input section
            document.getElementById('inputSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function restartQuiz() {
            // Confirm before restarting
            if (!confirm(translations[currentLanguage].confirmRestart)) {
                return;
            }

            // Reset timer to original time if exam mode is enabled
            if (examModeEnabled) {
                stopTimer();
                const hours = parseInt(document.getElementById('timerHours').value) || 0;
                const minutes = parseInt(document.getElementById('timerMinutes').value) || 30;
                timeRemaining = (hours * 3600) + (minutes * 60);
                startTimer();
            }

            // Clear answers but keep questions
            isGraded = false;
            incorrectQuestions.clear();

            // Clear all answer selections and enable inputs
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.checked = false;
            });
            enableQuizInputs();

            // Clear result displays
            document.querySelectorAll('.question-result').forEach(result => {
                result.classList.add('hidden');
            });

            // Hide result section and retry buttons
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('retryIncorrectBtn').classList.add('hidden');
            document.getElementById('filterSection').style.display = 'none';

            // Update navigator
            updateQuestionNavigator();

            // Scroll to top of quiz
            document.getElementById('quizSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Question Navigator functions
        function generateQuestionNavigator() {
            const navList = document.getElementById('questionNavList');
            navList.innerHTML = '';

            quizData.forEach((q, index) => {
                const navItem = document.createElement('div');
                navItem.className = 'question-nav-item';
                navItem.id = `nav-q${index}`;
                navItem.textContent = index + 1;
                navItem.onclick = () => navigateToQuestion(index);
                navList.appendChild(navItem);
            });

            // Show navigator and toggle button
            document.getElementById('questionNavigator').classList.add('active');
            document.getElementById('sidebarToggleBtn').classList.add('active');

            // Show fixed right timer and control panel if exam mode enabled
            if (examModeEnabled) {
                document.getElementById('fixedRightTimer').classList.add('active');
            }

            // Always show control panel when quiz is displayed
            document.getElementById('fixedControlPanel').classList.add('active');

            // Initial update to show pinned status
            updateQuestionNavigator();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('questionNavigator');
            sidebar.classList.toggle('open');
        }

        function updateQuestionNavigator() {
            quizData.forEach((q, index) => {
                const navItem = document.getElementById(`nav-q${index}`);
                if (!navItem) return;

                // Reset classes
                navItem.className = 'question-nav-item';

                // Check if answered
                const originalNumber = questionMapping[index];
                const isPinned = pinnedQuestions.has(originalNumber);
                const isMultiple = isMultipleAnswer(originalNumber);
                let isAnswered = false;

                if (isMultiple) {
                    const selectedOptions = document.querySelectorAll(`input[name="question${index}"]:checked`);
                    isAnswered = selectedOptions.length > 0;
                } else {
                    const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                    isAnswered = selectedOption !== null;
                }

                // Add pinned class if this question is pinned
                if (isPinned) {
                    navItem.classList.add('pinned');
                }

                if (isAnswered) {
                    navItem.classList.add('answered');
                }

                // If graded, show correct/incorrect
                if (isGraded) {
                    if (incorrectQuestions.has(originalNumber)) {
                        navItem.classList.remove('answered');
                        navItem.classList.add('incorrect');
                    } else {
                        navItem.classList.remove('answered');
                        navItem.classList.add('correct');
                    }
                }
            });
        }

        function navigateToQuestion(index) {
            const questionCard = document.getElementById(`card${index}`);
            if (questionCard) {
                // Remove current highlight from all nav items
                document.querySelectorAll('.question-nav-item').forEach(item => {
                    item.classList.remove('current');
                });

                // Add current highlight
                const navItem = document.getElementById(`nav-q${index}`);
                if (navItem) {
                    navItem.classList.add('current');
                }

                // Scroll to question
                questionCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Remove highlight after 2 seconds
                setTimeout(() => {
                    if (navItem) {
                        navItem.classList.remove('current');
                    }
                }, 2000);
            }
        }

        // Setup answer change listeners
        function setupAnswerListeners() {
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.addEventListener('change', () => {
                    updateQuestionNavigator();
                });
            });
        }

        function retryAllQuestions() {
            // Retry all original questions
            generateQuiz();
        }

        function retryIncorrectQuestions() {
            if (incorrectQuestions.size === 0) {
                alert(translations[currentLanguage].alertNoIncorrect);
                return;
            }
            generateQuiz(incorrectQuestions);
        }

        function retryPinnedQuestions() {
            if (pinnedQuestions.size === 0) {
                alert(translations[currentLanguage].alertNoPinned);
                return;
            }
            generateQuiz(pinnedQuestions);
        }

        function filterQuestions(filterType) {
            currentFilter = filterType;

            // Update active filter button
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filter question cards
            quizData.forEach((q, index) => {
                const card = document.getElementById(`card${index}`);
                const originalNumber = questionMapping[index];
                let shouldShow = false;

                switch(filterType) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'pinned':
                        shouldShow = pinnedQuestions.has(originalNumber);
                        break;
                    case 'incorrect':
                        shouldShow = incorrectQuestions.has(originalNumber);
                        break;
                }

                if (shouldShow) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // File import functions
        async function handleQuestionsFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileInfo = document.getElementById('questionsFileInfo');
            fileInfo.textContent = `ƒêang x·ª≠ l√Ω: ${file.name}...`;

            try {
                const text = await readFile(file);
                document.getElementById('questionsInput').value = text;
                fileInfo.textContent = `‚úì ƒê√£ import: ${file.name}`;
                fileInfo.style.color = '#28a745';

                // Auto-save
                autoSaveQuestions();
            } catch (error) {
                fileInfo.textContent = `‚úó L·ªói: ${error.message}`;
                fileInfo.style.color = '#dc3545';
            }

            // Reset file input
            event.target.value = '';
        }

        async function handleAnswersFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileInfo = document.getElementById('answersFileInfo');
            fileInfo.textContent = `ƒêang x·ª≠ l√Ω: ${file.name}...`;

            try {
                const text = await readFile(file);
                document.getElementById('answersInput').value = text;
                fileInfo.textContent = `‚úì ƒê√£ import: ${file.name}`;
                fileInfo.style.color = '#28a745';

                // Auto-save
                autoSaveAnswers();
            } catch (error) {
                fileInfo.textContent = `‚úó L·ªói: ${error.message}`;
                fileInfo.style.color = '#dc3545';
            }

            // Reset file input
            event.target.value = '';
        }

        // Global image storage for base64 mapping
        let imageStorage = {};
        let imageCounter = 0;

        // Handle image upload and convert to base64
        async function handleImageUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            const textarea = document.getElementById('questionsInput');
            const fileInfo = document.getElementById('questionsFileInfo');

            try {
                fileInfo.textContent = `ƒêang x·ª≠ l√Ω ${files.length} ·∫£nh...`;
                fileInfo.style.color = '#667eea';

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];

                    // Check if file is an image
                    if (!file.type.startsWith('image/')) {
                        throw new Error(`${file.name} kh√¥ng ph·∫£i l√† file ·∫£nh h·ª£p l·ªá`);
                    }

                    // Convert image to base64
                    const base64 = await imageToBase64(file);

                    // Generate unique image ID
                    imageCounter++;
                    const imageId = `IMG${imageCounter}`;
                    imageStorage[imageId] = base64;

                    // Insert short placeholder tag instead of full base64
                    const cursorPos = textarea.selectionStart;
                    const textBefore = textarea.value.substring(0, cursorPos);
                    const textAfter = textarea.value.substring(cursorPos);
                    const imageTag = `[${imageId}:${file.name}]\n`;

                    textarea.value = textBefore + imageTag + textAfter;

                    // Move cursor after inserted tag
                    const newPos = cursorPos + imageTag.length;
                    textarea.selectionStart = newPos;
                    textarea.selectionEnd = newPos;
                    textarea.focus();
                }

                fileInfo.textContent = `‚úì ƒê√£ th√™m ${files.length} ·∫£nh`;
                fileInfo.style.color = '#28a745';

                // Auto-save
                autoSaveQuestions();

                setTimeout(() => {
                    fileInfo.textContent = '';
                }, 3000);
            } catch (error) {
                fileInfo.textContent = `‚úó L·ªói: ${error.message}`;
                fileInfo.style.color = '#dc3545';
            }

            // Reset file input
            event.target.value = '';
        }

        // Convert image file to base64
        function imageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    resolve(e.target.result);
                };
                reader.onerror = () => {
                    reject(new Error(`Kh√¥ng th·ªÉ ƒë·ªçc file: ${file.name}`));
                };
                reader.readAsDataURL(file);
            });
        }

        async function readFile(file) {
            const extension = file.name.split('.').pop().toLowerCase();

            if (extension === 'txt') {
                return await readTextFile(file);
            } else if (extension === 'xlsx' || extension === 'xls') {
                return await readExcelFile(file);
            } else if (extension === 'docx') {
                return await readWordFile(file);
            } else {
                throw new Error('ƒê·ªãnh d·∫°ng file kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£');
            }
        }

        function readTextFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => reject(new Error('Kh√¥ng th·ªÉ ƒë·ªçc file text'));
                reader.readAsText(file);
            });
        }

        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // Get first sheet
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];

                        // Convert to CSV then process (better encoding handling)
                        const csv = XLSX.utils.sheet_to_csv(worksheet, { FS: '\t', RS: '\n' });

                        // Remove BOM (Byte Order Mark) if present
                        let text = csv.replace(/^\uFEFF/, ''); // UTF-8 BOM
                        text = text.replace(/^√ø√æ/, '');        // UTF-16 LE BOM
                        text = text.replace(/^\xEF\xBB\xBF/, ''); // UTF-8 BOM (another form)

                        // Clean up: remove extra tabs and spaces
                        const cleaned = text.split('\n')
                            .map(line => line.trim())
                            .filter(line => line.length > 0)
                            .join('\n');

                        resolve(cleaned);
                    } catch (error) {
                        reject(new Error('Kh√¥ng th·ªÉ ƒë·ªçc file Excel: ' + error.message));
                    }
                };
                reader.onerror = () => reject(new Error('Kh√¥ng th·ªÉ ƒë·ªçc file Excel'));
                reader.readAsArrayBuffer(file);
            });
        }

        function readWordFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    mammoth.extractRawText({ arrayBuffer: e.target.result })
                        .then(result => {
                            // Clean up the text
                            const cleaned = result.value
                                .split('\n')
                                .map(line => line.trim())
                                .filter(line => line.length > 0)
                                .join('\n');
                            resolve(cleaned);
                        })
                        .catch(error => reject(new Error('Kh√¥ng th·ªÉ ƒë·ªçc file Word: ' + error.message)));
                };
                reader.onerror = () => reject(new Error('Kh√¥ng th·ªÉ ƒë·ªçc file Word'));
                reader.readAsArrayBuffer(file);
            });
        }

        // Export functions
        function exportQuestions(format) {
            const text = document.getElementById('questionsInput').value;
            if (!text.trim()) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu c√¢u h·ªèi ƒë·ªÉ export!');
                return;
            }

            if (format === 'txt') {
                downloadTextFile(text, 'cau-hoi.txt');
            } else if (format === 'xlsx') {
                downloadExcelFile(text, 'cau-hoi.xlsx');
            }
        }

        function exportAnswers(format) {
            const text = document.getElementById('answersInput').value;
            if (!text.trim()) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë√°p √°n ƒë·ªÉ export!');
                return;
            }

            if (format === 'txt') {
                downloadTextFile(text, 'dap-an.txt');
            } else if (format === 'xlsx') {
                downloadExcelFile(text, 'dap-an.xlsx');
            }
        }

        function downloadTextFile(text, filename) {
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadExcelFile(text, filename) {
            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();

            // Split text into lines and convert to array of arrays
            const lines = text.split('\n').map(line => [line]);

            // Create worksheet from the data
            const ws = XLSX.utils.aoa_to_sheet(lines);

            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');

            // Generate Excel file and trigger download
            XLSX.writeFile(wb, filename);
        }
    </script>
</body>
</html>
