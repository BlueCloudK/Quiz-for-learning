<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng d·ª•ng Quiz - T·∫°o v√† Ch·∫•m ƒêi·ªÉm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-selector select {
            padding: 8px 15px;
            border: 2px solid white;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .language-selector select:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .language-selector select option {
            background: #667eea;
            color: white;
        }

        .language-selector label {
            font-size: 0.9em;
            font-weight: 600;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .hint {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            margin-top: 20px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #quizContainer {
            margin-top: 30px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .question-header {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .question-text {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .options {
            margin-left: 20px;
        }

        .option {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option label {
            cursor: pointer;
            margin: 0;
            flex: 1;
        }

        .result-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }

        .result-section h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }

        .result-details {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 10px;
        }

        .result-item h3 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .result-item p {
            font-size: 2em;
            font-weight: bold;
        }

        .question-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
        }

        .question-result.correct {
            background: #d4edda;
            color: #155724;
        }

        .question-result.incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .hidden {
            display: none;
        }

        .pin-button {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px 10px;
            margin-left: 10px;
            transition: all 0.3s;
            text-transform: none;
            letter-spacing: normal;
        }

        .pin-button:hover {
            transform: scale(1.2);
        }

        .pin-button.pinned {
            color: #ffd700;
        }

        .pin-button.unpinned {
            color: #ccc;
        }

        .question-card.pinned {
            border-left-color: #ffd700;
            background: #fffdf0;
        }

        .question-header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .filter-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 10px;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-button {
            padding: 8px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: 600;
        }

        .filter-button:hover {
            background: #667eea;
            color: white;
        }

        .filter-button.active {
            background: #667eea;
            color: white;
        }

        .ai-prompts-section {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .ai-prompts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .ai-prompts-header h3 {
            font-size: 1.2em;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        .ai-prompts-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .ai-prompts-content.expanded {
            max-height: 2000px;
            margin-top: 20px;
        }

        .prompt-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .prompt-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .prompt-card p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .prompt-text {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .copy-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            button:not(.pin-button):not(.filter-button) {
                width: 100%;
            }

            .question-header-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-selector">
                <label for="languageSelect" data-i18n="language">üåê</label>
                <select id="languageSelect" onchange="changeLanguage(this.value)">
                    <option value="vi">Ti·∫øng Vi·ªát</option>
                    <option value="en">English</option>
                </select>
            </div>
            <h1 data-i18n="title">üìù ·ª®ng d·ª•ng Quiz</h1>
            <p data-i18n="subtitle">T·∫°o b·ªô c√¢u h·ªèi, x√°o tr·ªôn v√† ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông</p>
        </div>

        <div class="content">
            <!-- AI Prompts Section -->
            <div class="ai-prompts-section">
                <div class="ai-prompts-header" onclick="toggleAIPrompts()">
                    <h3>
                        <span>ü§ñ</span>
                        <span data-i18n="aiPromptsTitle">H∆∞·ªõng D·∫´n T·∫°o C√¢u H·ªèi V·ªõi AI Chatbot</span>
                    </h3>
                    <span class="toggle-icon" id="toggleIcon">‚ñº</span>
                </div>
                <div class="ai-prompts-content" id="aiPromptsContent">
                    <p data-i18n="aiPromptsDesc">Copy c√°c prompt sau v√† paste v√†o ChatGPT, Claude, ho·∫∑c AI chatbot kh√°c ƒë·ªÉ t·ª± ƒë·ªông t·∫°o c√¢u h·ªèi ƒë√∫ng format:</p>

                    <div id="promptsContainer"></div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="section" id="inputSection">
                <h2 class="section-title" data-i18n="step1">B∆∞·ªõc 1: Nh·∫≠p D·ªØ Li·ªáu</h2>

                <div class="input-group">
                    <label for="questionsInput" data-i18n="questionsLabel">C√¢u h·ªèi v√† ƒë√°p √°n:</label>
                    <textarea id="questionsInput" rows="12" data-i18n-placeholder="questionsPlaceholder"></textarea>
                    <p class="hint" data-i18n="questionsHint">M·ªói c√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng s·ªë th·ª© t·ª±, c√°c ƒë√°p √°n b·∫Øt ƒë·∫ßu b·∫±ng a, b, c, d...</p>
                </div>

                <div class="input-group">
                    <label for="answersInput" data-i18n="answersLabel">ƒê√°p √°n ƒë√∫ng:</label>
                    <textarea id="answersInput" rows="6" data-i18n-placeholder="answersPlaceholder"></textarea>
                    <p class="hint" data-i18n="answersHint">Nh·∫≠p ƒë√°p √°n ƒë√∫ng cho m·ªói c√¢u theo s·ªë th·ª© t·ª±</p>
                </div>

                <div class="controls">
                    <div class="checkbox-group">
                        <input type="checkbox" id="shuffleCheckbox">
                        <label for="shuffleCheckbox" data-i18n="shuffleLabel">X√°o tr·ªôn c√¢u h·ªèi</label>
                    </div>
                    <button class="btn-primary" onclick="generateQuiz()" data-i18n="createQuizBtn">T·∫°o Quiz</button>
                </div>
            </div>

            <!-- Quiz Section -->
            <div class="section hidden" id="quizSection">
                <h2 class="section-title" data-i18n="step2">B∆∞·ªõc 2: L√†m B√†i Quiz</h2>

                <!-- Filter Section -->
                <div class="filter-section" id="filterSection" style="display: none;">
                    <label style="margin-bottom: 10px;" data-i18n="filterLabel">L·ªçc c√¢u h·ªèi:</label>
                    <div class="filter-buttons">
                        <button class="filter-button active" onclick="filterQuestions('all')" data-i18n="filterAll">T·∫•t c·∫£</button>
                        <button class="filter-button" onclick="filterQuestions('pinned')" data-i18n="filterPinned">C√¢u ƒë√£ pin</button>
                        <button class="filter-button" onclick="filterQuestions('incorrect')" data-i18n="filterIncorrect">C√¢u sai</button>
                    </div>
                </div>

                <div id="quizContainer"></div>
                <div class="controls">
                    <button class="btn-success" onclick="submitQuiz()" data-i18n="submitBtn">Ch·∫•m ƒêi·ªÉm</button>
                    <button class="btn-secondary" onclick="resetQuiz()" data-i18n="resetBtn">L√†m L·∫°i</button>
                    <button class="btn-warning hidden" id="retryIncorrectBtn" onclick="retryIncorrectQuestions()" data-i18n="retryIncorrectBtn">L√†m L·∫°i C√¢u Sai</button>
                    <button class="btn-info hidden" id="retryPinnedBtn" onclick="retryPinnedQuestions()" data-i18n="retryPinnedBtn">L√†m L·∫°i C√¢u ƒê√£ Pin</button>
                </div>
            </div>

            <!-- Result Section -->
            <div id="resultSection" class="hidden"></div>
        </div>
    </div>

    <script>
        let quizData = [];
        let correctAnswers = {};
        let questionMapping = {}; // L∆∞u mapping gi·ªØa v·ªã tr√≠ hi·ªán t·∫°i v√† s·ªë th·ª© t·ª± g·ªëc
        let pinnedQuestions = new Set(); // L∆∞u index c√°c c√¢u ƒë∆∞·ª£c pin
        let incorrectQuestions = new Set(); // L∆∞u index c√°c c√¢u sai
        let isGraded = false; // Track xem ƒë√£ ch·∫•m ƒëi·ªÉm ch∆∞a
        let originalQuestionsText = ''; // L∆∞u c√¢u h·ªèi g·ªëc
        let originalAnswersText = ''; // L∆∞u ƒë√°p √°n g·ªëc
        let currentFilter = 'all'; // B·ªô l·ªçc hi·ªán t·∫°i
        let currentLanguage = 'vi'; // Ng√¥n ng·ªØ hi·ªán t·∫°i

        // Translations
        const translations = {
            vi: {
                title: 'üìù ·ª®ng d·ª•ng Quiz',
                subtitle: 'T·∫°o b·ªô c√¢u h·ªèi, x√°o tr·ªôn v√† ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông',
                step1: 'B∆∞·ªõc 1: Nh·∫≠p D·ªØ Li·ªáu',
                step2: 'B∆∞·ªõc 2: L√†m B√†i Quiz',
                questionsLabel: 'C√¢u h·ªèi v√† ƒë√°p √°n:',
                questionsPlaceholder: 'Nh·∫≠p c√¢u h·ªèi theo ƒë·ªãnh d·∫°ng:\n\n1. C√¢u h·ªèi th·ª© nh·∫•t?\na. ƒê√°p √°n A\nb. ƒê√°p √°n B\nc. ƒê√°p √°n C\nd. ƒê√°p √°n D\n\n2. C√¢u h·ªèi th·ª© hai?\na. ƒê√°p √°n A\nb. ƒê√°p √°n B\nc. ƒê√°p √°n C\nd. ƒê√°p √°n D',
                questionsHint: 'M·ªói c√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng s·ªë th·ª© t·ª±, c√°c ƒë√°p √°n b·∫Øt ƒë·∫ßu b·∫±ng a, b, c, d...',
                answersLabel: 'ƒê√°p √°n ƒë√∫ng:',
                answersPlaceholder: 'Nh·∫≠p ƒë√°p √°n theo ƒë·ªãnh d·∫°ng:\n\n1. a\n2. b\n3. c\n4. d\n\nNhi·ªÅu ƒë√°p √°n ƒë√∫ng:\n5. a,b,c\n6. abc',
                answersHint: 'Nh·∫≠p ƒë√°p √°n ƒë√∫ng cho m·ªói c√¢u. Nhi·ªÅu ƒë√°p √°n: d√πng d·∫•u ph·∫©y (a,b,c) ho·∫∑c vi·∫øt li·ªÅn (abc)',
                shuffleLabel: 'X√°o tr·ªôn c√¢u h·ªèi',
                createQuizBtn: 'T·∫°o Quiz',
                filterLabel: 'L·ªçc c√¢u h·ªèi:',
                filterAll: 'T·∫•t c·∫£',
                filterPinned: 'C√¢u ƒë√£ pin',
                filterIncorrect: 'C√¢u sai',
                submitBtn: 'Ch·∫•m ƒêi·ªÉm',
                resetBtn: 'L√†m L·∫°i',
                retryIncorrectBtn: 'L√†m L·∫°i C√¢u Sai',
                retryPinnedBtn: 'L√†m L·∫°i C√¢u ƒê√£ Pin',
                question: 'C√¢u',
                pinQuestion: 'Pin c√¢u h·ªèi',
                unpinQuestion: 'B·ªè pin',
                correct: '‚úì Ch√≠nh x√°c!',
                incorrect: '‚úó Sai - ƒê√°p √°n ƒë√∫ng:',
                unanswered: 'Ch∆∞a tr·∫£ l·ªùi - ƒê√°p √°n ƒë√∫ng:',
                resultTitle: 'üéâ K·∫øt Qu·∫£ C·ªßa B·∫°n',
                totalQuestions: 'T·ªïng c√¢u',
                correctAnswers: 'ƒê√∫ng',
                incorrectAnswers: 'Sai',
                unansweredQuestions: 'Ch∆∞a tr·∫£ l·ªùi',
                alertNoData: 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß c√¢u h·ªèi v√† ƒë√°p √°n!',
                alertNoQuestions: 'Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi h·ª£p l·ªá! Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng.',
                alertNoIncorrect: 'Kh√¥ng c√≥ c√¢u sai n√†o ƒë·ªÉ l√†m l·∫°i!',
                alertNoPinned: 'Ch∆∞a c√≥ c√¢u h·ªèi n√†o ƒë∆∞·ª£c pin!',
                alertNoRetry: 'Kh√¥ng c√≥ c√¢u h·ªèi n√†o ƒë·ªÉ l√†m l·∫°i!',
                confirmReset: 'B·∫°n c√≥ ch·∫Øc mu·ªën l√†m l·∫°i? T·∫•t c·∫£ c√¢u tr·∫£ l·ªùi s·∫Ω b·ªã x√≥a.',
                aiPromptsTitle: 'H∆∞·ªõng D·∫´n T·∫°o C√¢u H·ªèi V·ªõi AI Chatbot',
                aiPromptsDesc: 'Copy c√°c prompt sau v√† paste v√†o ChatGPT, Claude, ho·∫∑c AI chatbot kh√°c ƒë·ªÉ t·ª± ƒë·ªông t·∫°o c√¢u h·ªèi ƒë√∫ng format:',
                copyBtn: 'Copy',
                copiedBtn: '‚úì ƒê√£ copy!'
            },
            en: {
                title: 'üìù Quiz Application',
                subtitle: 'Create quizzes, shuffle questions, and auto-grade',
                step1: 'Step 1: Input Data',
                step2: 'Step 2: Take the Quiz',
                questionsLabel: 'Questions and Answers:',
                questionsPlaceholder: 'Enter questions in this format:\n\n1. First question?\na. Answer A\nb. Answer B\nc. Answer C\nd. Answer D\n\n2. Second question?\na. Answer A\nb. Answer B\nc. Answer C\nd. Answer D',
                questionsHint: 'Each question starts with a number, answers start with a, b, c, d...',
                answersLabel: 'Correct Answers:',
                answersPlaceholder: 'Enter answers in this format:\n\n1. a\n2. b\n3. c\n4. d\n\nMultiple correct answers:\n5. a,b,c\n6. abc',
                answersHint: 'Enter correct answers for each question. Multiple answers: use comma (a,b,c) or write together (abc)',
                shuffleLabel: 'Shuffle questions',
                createQuizBtn: 'Create Quiz',
                filterLabel: 'Filter questions:',
                filterAll: 'All',
                filterPinned: 'Pinned',
                filterIncorrect: 'Incorrect',
                submitBtn: 'Submit & Grade',
                resetBtn: 'Reset',
                retryIncorrectBtn: 'Retry Incorrect',
                retryPinnedBtn: 'Retry Pinned',
                question: 'Question',
                pinQuestion: 'Pin question',
                unpinQuestion: 'Unpin',
                correct: '‚úì Correct!',
                incorrect: '‚úó Incorrect - Correct answer:',
                unanswered: 'Not answered - Correct answer:',
                resultTitle: 'üéâ Your Results',
                totalQuestions: 'Total',
                correctAnswers: 'Correct',
                incorrectAnswers: 'Incorrect',
                unansweredQuestions: 'Not Answered',
                alertNoData: 'Please enter both questions and answers!',
                alertNoQuestions: 'No valid questions found! Please check the format.',
                alertNoIncorrect: 'No incorrect questions to retry!',
                alertNoPinned: 'No questions have been pinned yet!',
                alertNoRetry: 'No questions to retry!',
                confirmReset: 'Are you sure you want to reset? All answers will be lost.',
                aiPromptsTitle: 'Generate Questions With AI Chatbot',
                aiPromptsDesc: 'Copy these prompts and paste into ChatGPT, Claude, or other AI chatbots to automatically generate questions in the correct format:',
                copyBtn: 'Copy',
                copiedBtn: '‚úì Copied!'
            }
        };

        // AI Prompts templates
        const aiPrompts = {
            vi: [
                {
                    title: 'üìö T·∫°o B·ªô C√¢u H·ªèi V·ªÅ Ch·ªß ƒê·ªÅ B·∫•t K·ª≥',
                    description: 'T·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám v·ªÅ ch·ªß ƒë·ªÅ b·∫°n mu·ªën h·ªçc',
                    prompt: `H√£y t·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám v·ªÅ [TOPIC] theo ƒë·ªãnh d·∫°ng sau:

1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]

Sau ƒë√≥, cung c·∫•p ƒë√°p √°n ƒë√∫ng theo format:
1. [ƒë√°p √°n ƒë√∫ng]

V√≠ d·ª•:
1. Python l√† ng√¥n ng·ªØ l·∫≠p tr√¨nh g√¨?
a. Compiled
b. Interpreted
c. Assembly
d. Machine code

ƒê√°p √°n:
1. b

[Thay TOPIC b·∫±ng ch·ªß ƒë·ªÅ c·ªßa b·∫°n, v√≠ d·ª•: L·ªãch s·ª≠ Vi·ªát Nam, To√°n h·ªçc l·ªõp 10, JavaScript, etc.]`
                },
                {
                    title: 'üéì √în T·∫≠p K·ª≥ Thi',
                    description: 'T·∫°o c√¢u h·ªèi √¥n t·∫≠p d·ª±a tr√™n n·ªôi dung c·ª• th·ªÉ',
                    prompt: `D·ª±a tr√™n n·ªôi dung sau ƒë√¢y, t·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám:

[PASTE CONTENT ·ªû ƒê√ÇY]

ƒê·ªãnh d·∫°ng c√¢u h·ªèi:
1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]

ƒê·ªãnh d·∫°ng ƒë√°p √°n:
1. [a/b/c/d]

L∆∞u √Ω:
- C√¢u h·ªèi ph·∫£i ki·ªÉm tra s·ª± hi·ªÉu bi·∫øt, kh√¥ng ch·ªâ ghi nh·ªõ
- C√°c ƒë√°p √°n sai ph·∫£i h·ª£p l√Ω v√† g√¢y nh·∫ßm l·∫´n
- ƒê·∫£m b·∫£o ch·ªâ c√≥ 1 ƒë√°p √°n ƒë√∫ng`
                },
                {
                    title: 'üí° C√¢u H·ªèi Nhi·ªÅu ƒê√°p √Ån ƒê√∫ng',
                    description: 'T·∫°o c√¢u h·ªèi c√≥ nhi·ªÅu ƒë√°p √°n ƒë√∫ng (checkbox)',
                    prompt: `T·∫°o 5 c√¢u h·ªèi v·ªÅ [TOPIC] m√† m·ªói c√¢u c√≥ NHI·ªÄU ƒë√°p √°n ƒë√∫ng:

ƒê·ªãnh d·∫°ng c√¢u h·ªèi:
1. [C√¢u h·ªèi] (ch·ªçn t·∫•t c·∫£ ƒë√°p √°n ƒë√∫ng)
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]
e. [ƒê√°p √°n E]

ƒê·ªãnh d·∫°ng ƒë√°p √°n (nhi·ªÅu ƒë√°p √°n ƒë√∫ng):
1. a,c,e
ho·∫∑c
1. ace

V√≠ d·ª•:
1. Ng√¥n ng·ªØ n√†o sau ƒë√¢y h·ªó tr·ª£ l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng?
a. Python
b. Java
c. C
d. JavaScript
e. Assembly

ƒê√°p √°n:
1. a,b,d`
                },
                {
                    title: 'üåç H·ªçc Ngo·∫°i Ng·ªØ',
                    description: 'T·∫°o b√†i t·∫≠p t·ª´ v·ª±ng v√† ng·ªØ ph√°p',
                    prompt: `T·∫°o 10 c√¢u h·ªèi tr·∫Øc nghi·ªám h·ªçc [NG√îN NG·ªÆ]:

5 c√¢u ƒë·∫ßu: T·ª´ v·ª±ng (nghƒ©a c·ªßa t·ª´)
5 c√¢u sau: Ng·ªØ ph√°p (ƒëi·ªÅn t·ª´ ƒë√∫ng v√†o ch·ªó tr·ªëng)

ƒê·ªãnh d·∫°ng:
1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]

ƒê√°p √°n:
1. [a/b/c/d]

V√≠ d·ª• v·ªÅ t·ª´ v·ª±ng:
1. "Beautiful" c√≥ nghƒ©a l√† g√¨?
a. X·∫•u
b. ƒê·∫πp
c. T·ªët
d. Cao

V√≠ d·ª• v·ªÅ ng·ªØ ph√°p:
2. She ___ to school every day.
a. go
b. goes
c. going
d. went

ƒê√°p √°n:
1. b
2. b`
                },
                {
                    title: 'üß™ Khoa H·ªçc & C√¥ng Ngh·ªá',
                    description: 'C√¢u h·ªèi khoa h·ªçc v·ªõi nhi·ªÅu l·ª±a ch·ªçn',
                    prompt: `T·∫°o 10 c√¢u h·ªèi khoa h·ªçc v·ªÅ [TOPIC] v·ªõi 5-6 l·ª±a ch·ªçn cho m·ªói c√¢u:

ƒê·ªãnh d·∫°ng:
1. [C√¢u h·ªèi]
a. [ƒê√°p √°n A]
b. [ƒê√°p √°n B]
c. [ƒê√°p √°n C]
d. [ƒê√°p √°n D]
e. [ƒê√°p √°n E]
f. [ƒê√°p √°n F] (n·∫øu c·∫ßn)

ƒê√°p √°n:
1. [a/b/c/d/e/f]

Y√™u c·∫ßu:
- ƒê·ªô kh√≥: trung b√¨nh ƒë·∫øn kh√≥
- Bao g·ªìm c·∫£ c√¢u h·ªèi l√Ω thuy·∫øt v√† ·ª©ng d·ª•ng
- ƒê√°p √°n sai ph·∫£i h·ª£p l√Ω v·ªÅ m·∫∑t khoa h·ªçc`
                }
            ],
            en: [
                {
                    title: 'üìö Create Quiz on Any Topic',
                    description: 'Generate 10 multiple choice questions about any subject',
                    prompt: `Create 10 multiple choice questions about [TOPIC] in this format:

1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]

Then provide correct answers in this format:
1. [correct answer]

Example:
1. What type of programming language is Python?
a. Compiled
b. Interpreted
c. Assembly
d. Machine code

Answers:
1. b

[Replace TOPIC with your subject, e.g.: World History, Calculus, JavaScript, etc.]`
                },
                {
                    title: 'üéì Exam Review',
                    description: 'Create review questions based on specific content',
                    prompt: `Based on the following content, create 10 multiple choice questions:

[PASTE CONTENT HERE]

Question format:
1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]

Answer format:
1. [a/b/c/d]

Note:
- Questions should test understanding, not just memorization
- Wrong answers should be plausible and challenging
- Ensure only one correct answer`
                },
                {
                    title: 'üí° Multiple Correct Answers',
                    description: 'Create questions with multiple correct answers (checkbox)',
                    prompt: `Create 5 questions about [TOPIC] where each has MULTIPLE correct answers:

Question format:
1. [Question] (select all that apply)
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]
e. [Answer E]

Answer format (multiple correct):
1. a,c,e
or
1. ace

Example:
1. Which languages support object-oriented programming?
a. Python
b. Java
c. C
d. JavaScript
e. Assembly

Answers:
1. a,b,d`
                },
                {
                    title: 'üåç Language Learning',
                    description: 'Create vocabulary and grammar exercises',
                    prompt: `Create 10 multiple choice questions for learning [LANGUAGE]:

First 5: Vocabulary (word meanings)
Last 5: Grammar (fill in the blank)

Format:
1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]

Answers:
1. [a/b/c/d]

Vocabulary example:
1. What does "Beautiful" mean?
a. Ugly
b. Pretty
c. Good
d. Tall

Grammar example:
2. She ___ to school every day.
a. go
b. goes
c. going
d. went

Answers:
1. b
2. b`
                },
                {
                    title: 'üß™ Science & Technology',
                    description: 'Science questions with more options',
                    prompt: `Create 10 science questions about [TOPIC] with 5-6 options each:

Format:
1. [Question]
a. [Answer A]
b. [Answer B]
c. [Answer C]
d. [Answer D]
e. [Answer E]
f. [Answer F] (if needed)

Answers:
1. [a/b/c/d/e/f]

Requirements:
- Difficulty: medium to hard
- Include both theoretical and applied questions
- Wrong answers should be scientifically plausible`
                }
            ]
        };

        function changeLanguage(lang) {
            currentLanguage = lang;

            // Update all elements with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });

            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });

            // Update pin button titles if quiz is displayed
            if (!document.getElementById('quizSection').classList.contains('hidden')) {
                quizData.forEach((q, index) => {
                    const originalNumber = questionMapping[index];
                    const isPinned = pinnedQuestions.has(originalNumber);
                    const pinButton = document.getElementById(`pin${index}`);
                    if (pinButton) {
                        pinButton.title = isPinned ? translations[lang].unpinQuestion : translations[lang].pinQuestion;
                    }
                });
            }

            // Update result section if it exists
            if (isGraded && !document.getElementById('resultSection').classList.contains('hidden')) {
                // Re-display results with new language
                const resultDiv = document.getElementById('resultSection');
                if (resultDiv.innerHTML) {
                    // Results will be updated on next submit
                }
            }

            // Re-render AI prompts with new language
            renderAIPrompts();
        }

        // Initialize language on page load
        document.addEventListener('DOMContentLoaded', function() {
            changeLanguage('vi');
            renderAIPrompts();
        });

        function toggleAIPrompts() {
            const content = document.getElementById('aiPromptsContent');
            const icon = document.getElementById('toggleIcon');

            content.classList.toggle('expanded');
            icon.classList.toggle('rotated');
        }

        function renderAIPrompts() {
            const container = document.getElementById('promptsContainer');
            const prompts = aiPrompts[currentLanguage];

            container.innerHTML = prompts.map((prompt, index) => `
                <div class="prompt-card">
                    <h4>${prompt.title}</h4>
                    <p>${prompt.description}</p>
                    <div class="prompt-text" id="prompt${index}">${prompt.prompt}</div>
                    <button class="copy-btn" onclick="copyPrompt(${index})" id="copyBtn${index}">
                        <span>${translations[currentLanguage].copyBtn}</span>
                    </button>
                </div>
            `).join('');
        }

        function copyPrompt(index) {
            const promptText = aiPrompts[currentLanguage][index].prompt;
            const button = document.getElementById(`copyBtn${index}`);

            navigator.clipboard.writeText(promptText).then(() => {
                button.classList.add('copied');
                button.innerHTML = `<span>${translations[currentLanguage].copiedBtn}</span>`;

                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = `<span>${translations[currentLanguage].copyBtn}</span>`;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.');
            });
        }

        function parseQuestions(text) {
            const questions = [];
            const lines = text.trim().split('\n');
            let currentQuestion = null;

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                // Ki·ªÉm tra d√≤ng c√¢u h·ªèi (b·∫Øt ƒë·∫ßu b·∫±ng s·ªë)
                const questionMatch = line.match(/^(\d+)\.\s*(.+)/);
                if (questionMatch) {
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    currentQuestion = {
                        number: parseInt(questionMatch[1]),
                        question: questionMatch[2],
                        options: []
                    };
                    continue;
                }

                // Ki·ªÉm tra d√≤ng ƒë√°p √°n (b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ c√°i)
                const optionMatch = line.match(/^([a-z])\.\s*(.+)/i);
                if (optionMatch && currentQuestion) {
                    currentQuestion.options.push({
                        letter: optionMatch[1].toLowerCase(),
                        text: optionMatch[2]
                    });
                }
            }

            if (currentQuestion) {
                questions.push(currentQuestion);
            }

            return questions;
        }

        function parseAnswers(text) {
            const answers = {};
            const lines = text.trim().split(/[\n]+/);

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                // Match pattern: 1. a ho·∫∑c 1. a,b,c ho·∫∑c 1. abc ho·∫∑c 1.a 1.b 1.c
                const match = line.match(/^(\d+)\.\s*(.+)/);
                if (match) {
                    const questionNum = parseInt(match[1]);
                    let answerPart = match[2].trim();

                    // X·ª≠ l√Ω c√°c format: "a,b,c" ho·∫∑c "abc" ho·∫∑c "a b c"
                    answerPart = answerPart.replace(/\s+/g, ''); // Remove spaces

                    // N·∫øu c√≥ d·∫•u ph·∫©y, split by comma
                    if (answerPart.includes(',')) {
                        answers[questionNum] = answerPart.split(',').map(a => a.toLowerCase().trim());
                    } else if (answerPart.length > 1 && /^[a-z]+$/i.test(answerPart)) {
                        // N·∫øu l√† chu·ªói nhi·ªÅu ch·ªØ c√°i li√™n ti·∫øp (abc)
                        answers[questionNum] = answerPart.toLowerCase().split('');
                    } else {
                        // ƒê√°p √°n ƒë∆°n
                        answers[questionNum] = answerPart.toLowerCase();
                    }
                }
            }

            return answers;
        }

        function isMultipleAnswer(questionNumber) {
            const answer = correctAnswers[questionNumber];
            return Array.isArray(answer);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function generateQuiz(specificQuestions = null) {
            let questionsText, answersText;

            if (specificQuestions) {
                // T·∫°o quiz t·ª´ c√¢u h·ªèi c·ª• th·ªÉ (pin ho·∫∑c sai)
                questionsText = originalQuestionsText;
                answersText = originalAnswersText;
            } else {
                // T·∫°o quiz m·ªõi t·ª´ input
                questionsText = document.getElementById('questionsInput').value;
                answersText = document.getElementById('answersInput').value;
                originalQuestionsText = questionsText;
                originalAnswersText = answersText;
                pinnedQuestions.clear();
                incorrectQuestions.clear();
                isGraded = false;
            }

            const shouldShuffle = document.getElementById('shuffleCheckbox').checked;

            if (!questionsText.trim() || !answersText.trim()) {
                alert(translations[currentLanguage].alertNoData);
                return;
            }

            // Parse d·ªØ li·ªáu
            let allQuestions = parseQuestions(questionsText);
            correctAnswers = parseAnswers(answersText);

            if (allQuestions.length === 0) {
                alert(translations[currentLanguage].alertNoQuestions);
                return;
            }

            // L·ªçc c√¢u h·ªèi n·∫øu c√≥ specificQuestions
            if (specificQuestions) {
                quizData = allQuestions.filter(q => specificQuestions.has(q.number));
                if (quizData.length === 0) {
                    alert(translations[currentLanguage].alertNoRetry);
                    return;
                }
            } else {
                quizData = allQuestions;
            }

            // X√°o tr·ªôn n·∫øu c·∫ßn
            if (shouldShuffle && !specificQuestions) {
                quizData = shuffleArray(quizData);
            }

            // T·∫°o mapping
            questionMapping = {};
            quizData.forEach((q, index) => {
                questionMapping[index] = q.number;
            });

            // Reset tr·∫°ng th√°i
            isGraded = false;
            document.getElementById('retryIncorrectBtn').classList.add('hidden');
            document.getElementById('retryPinnedBtn').classList.add('hidden');
            document.getElementById('filterSection').style.display = 'none';

            // Hi·ªÉn th·ªã quiz
            displayQuiz();
            document.getElementById('inputSection').classList.add('hidden');
            document.getElementById('quizSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('hidden');
        }

        function displayQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';

            quizData.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.id = `card${index}`;

                // Check n·∫øu c√¢u n√†y ƒë√£ ƒë∆∞·ª£c pin
                const originalNumber = q.number;
                const isPinned = pinnedQuestions.has(originalNumber);
                const isIncorrect = incorrectQuestions.has(originalNumber);

                if (isPinned) {
                    questionCard.classList.add('pinned');
                }

                let html = `
                    <div class="question-header-container">
                        <div class="question-header">${translations[currentLanguage].question} ${index + 1}</div>
                        <button class="pin-button ${isPinned ? 'pinned' : 'unpinned'}"
                                onclick="togglePin(${index})"
                                id="pin${index}"
                                title="${isPinned ? translations[currentLanguage].unpinQuestion : translations[currentLanguage].pinQuestion}">
                            ${isPinned ? 'üìå' : 'üìç'}
                        </button>
                    </div>
                    <div class="question-text">${q.question}</div>
                    <div class="options">
                `;

                const isMultiple = isMultipleAnswer(originalNumber);
                const inputType = isMultiple ? 'checkbox' : 'radio';

                q.options.forEach(option => {
                    html += `
                        <div class="option">
                            <input type="${inputType}"
                                   name="question${index}"
                                   value="${option.letter}"
                                   id="q${index}_${option.letter}">
                            <label for="q${index}_${option.letter}">
                                ${option.letter.toUpperCase()}. ${option.text}
                            </label>
                        </div>
                    `;
                });

                html += `
                    </div>
                    <div class="question-result hidden" id="result${index}"></div>
                `;

                questionCard.innerHTML = html;
                container.appendChild(questionCard);
            });
        }

        function togglePin(index) {
            const originalNumber = questionMapping[index];
            const pinButton = document.getElementById(`pin${index}`);
            const card = document.getElementById(`card${index}`);

            if (pinnedQuestions.has(originalNumber)) {
                pinnedQuestions.delete(originalNumber);
                pinButton.classList.remove('pinned');
                pinButton.classList.add('unpinned');
                pinButton.textContent = 'üìç';
                pinButton.title = translations[currentLanguage].pinQuestion;
                card.classList.remove('pinned');
            } else {
                pinnedQuestions.add(originalNumber);
                pinButton.classList.remove('unpinned');
                pinButton.classList.add('pinned');
                pinButton.textContent = 'üìå';
                pinButton.title = translations[currentLanguage].unpinQuestion;
                card.classList.add('pinned');
            }

            // Update button visibility
            updateRetryButtons();
        }

        function submitQuiz() {
            let correctCount = 0;
            let incorrectCount = 0;
            let unanswered = 0;

            // Clear previous incorrect questions
            incorrectQuestions.clear();

            quizData.forEach((q, index) => {
                const originalNumber = questionMapping[index];
                const resultDiv = document.getElementById(`result${index}`);
                resultDiv.classList.remove('hidden');

                const isMultiple = isMultipleAnswer(originalNumber);
                let userAnswer;
                let isCorrect = false;

                if (isMultiple) {
                    // Checkbox - multiple answers
                    const selectedOptions = document.querySelectorAll(`input[name="question${index}"]:checked`);
                    if (selectedOptions.length === 0) {
                        userAnswer = null;
                    } else {
                        userAnswer = Array.from(selectedOptions).map(opt => opt.value).sort();
                        const correctAnswer = correctAnswers[originalNumber].slice().sort();

                        // So s√°nh arrays
                        isCorrect = userAnswer.length === correctAnswer.length &&
                                   userAnswer.every((val, idx) => val === correctAnswer[idx]);
                    }
                } else {
                    // Radio - single answer
                    const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                    if (!selectedOption) {
                        userAnswer = null;
                    } else {
                        userAnswer = selectedOption.value;
                        isCorrect = userAnswer === correctAnswers[originalNumber];
                    }
                }

                // Display result
                if (userAnswer === null) {
                    const correctAnswerDisplay = Array.isArray(correctAnswers[originalNumber])
                        ? correctAnswers[originalNumber].map(a => a.toUpperCase()).join(', ')
                        : correctAnswers[originalNumber].toUpperCase();
                    resultDiv.className = 'question-result incorrect';
                    resultDiv.textContent = `${translations[currentLanguage].unanswered} ${correctAnswerDisplay}`;
                    unanswered++;
                    incorrectCount++;
                    incorrectQuestions.add(originalNumber);
                } else if (isCorrect) {
                    resultDiv.className = 'question-result correct';
                    resultDiv.textContent = translations[currentLanguage].correct;
                    correctCount++;
                } else {
                    const correctAnswerDisplay = Array.isArray(correctAnswers[originalNumber])
                        ? correctAnswers[originalNumber].map(a => a.toUpperCase()).join(', ')
                        : correctAnswers[originalNumber].toUpperCase();
                    resultDiv.className = 'question-result incorrect';
                    resultDiv.textContent = `${translations[currentLanguage].incorrect} ${correctAnswerDisplay}`;
                    incorrectCount++;
                    incorrectQuestions.add(originalNumber);
                }
            });

            isGraded = true;
            displayResults(correctCount, incorrectCount, unanswered);
            updateRetryButtons();

            // Show filter section after grading
            if (isGraded) {
                document.getElementById('filterSection').style.display = 'block';
            }
        }

        function updateRetryButtons() {
            const retryIncorrectBtn = document.getElementById('retryIncorrectBtn');
            const retryPinnedBtn = document.getElementById('retryPinnedBtn');

            if (isGraded && incorrectQuestions.size > 0) {
                retryIncorrectBtn.classList.remove('hidden');
            } else {
                retryIncorrectBtn.classList.add('hidden');
            }

            if (pinnedQuestions.size > 0) {
                retryPinnedBtn.classList.remove('hidden');
            } else {
                retryPinnedBtn.classList.add('hidden');
            }
        }

        function displayResults(correct, incorrect, unanswered) {
            const total = quizData.length;
            const percentage = ((correct / total) * 100).toFixed(1);

            const resultSection = document.getElementById('resultSection');
            resultSection.innerHTML = `
                <h2>${translations[currentLanguage].resultTitle}</h2>
                <div class="score-display">${percentage}%</div>
                <div class="result-details">
                    <div class="result-item">
                        <h3>${translations[currentLanguage].totalQuestions}</h3>
                        <p>${total}</p>
                    </div>
                    <div class="result-item">
                        <h3>${translations[currentLanguage].correctAnswers}</h3>
                        <p style="color: #38ef7d;">${correct}</p>
                    </div>
                    <div class="result-item">
                        <h3>${translations[currentLanguage].incorrectAnswers}</h3>
                        <p style="color: #ff6b6b;">${incorrect}</p>
                    </div>
                    ${unanswered > 0 ? `
                    <div class="result-item">
                        <h3>${translations[currentLanguage].unansweredQuestions}</h3>
                        <p style="color: #ffd93d;">${unanswered}</p>
                    </div>
                    ` : ''}
                </div>
            `;
            resultSection.classList.remove('hidden');

            // Scroll to results
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetQuiz() {
            if (confirm(translations[currentLanguage].confirmReset)) {
                document.getElementById('inputSection').classList.remove('hidden');
                document.getElementById('quizSection').classList.add('hidden');
                document.getElementById('resultSection').classList.add('hidden');
                document.getElementById('questionsInput').value = '';
                document.getElementById('answersInput').value = '';
                document.getElementById('shuffleCheckbox').checked = false;
                quizData = [];
                correctAnswers = {};
                questionMapping = {};
                pinnedQuestions.clear();
                incorrectQuestions.clear();
                isGraded = false;
                originalQuestionsText = '';
                originalAnswersText = '';
            }
        }

        function retryIncorrectQuestions() {
            if (incorrectQuestions.size === 0) {
                alert(translations[currentLanguage].alertNoIncorrect);
                return;
            }
            generateQuiz(incorrectQuestions);
        }

        function retryPinnedQuestions() {
            if (pinnedQuestions.size === 0) {
                alert(translations[currentLanguage].alertNoPinned);
                return;
            }
            generateQuiz(pinnedQuestions);
        }

        function filterQuestions(filterType) {
            currentFilter = filterType;

            // Update active filter button
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filter question cards
            quizData.forEach((q, index) => {
                const card = document.getElementById(`card${index}`);
                const originalNumber = questionMapping[index];
                let shouldShow = false;

                switch(filterType) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'pinned':
                        shouldShow = pinnedQuestions.has(originalNumber);
                        break;
                    case 'incorrect':
                        shouldShow = incorrectQuestions.has(originalNumber);
                        break;
                }

                if (shouldShow) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
